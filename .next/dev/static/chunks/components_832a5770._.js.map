{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/CharacterAvatar.tsx"],"sourcesContent":["import { CharacterWithAccessories, BaseBody, Accessory, UserAccessory } from \"@shared/schema\";\r\n\r\ninterface CharacterAvatarProps {\r\n  characterData: CharacterWithAccessories | null;\r\n  size?: number;\r\n  className?: string;\r\n  showPlaceholder?: boolean;\r\n}\r\n\r\ninterface PlaceholderAvatarProps {\r\n  gender?: 'male' | 'female';\r\n  size: number;\r\n}\r\n\r\nfunction PlaceholderAvatar({ gender, size }: PlaceholderAvatarProps) {\r\n  const bgColor = gender === 'female' ? 'bg-pink-200 dark:bg-pink-900' : 'bg-blue-200 dark:bg-blue-900';\r\n  const iconColor = gender === 'female' ? 'text-pink-500' : 'text-blue-500';\r\n  \r\n  return (\r\n    <div \r\n      className={`${bgColor} rounded-full flex items-center justify-center`}\r\n      style={{ width: size, height: size }}\r\n      data-testid=\"character-avatar-placeholder\"\r\n    >\r\n      <svg \r\n        className={iconColor}\r\n        width={size * 0.6} \r\n        height={size * 0.6} \r\n        viewBox=\"0 0 24 24\" \r\n        fill=\"currentColor\"\r\n      >\r\n        <circle cx=\"12\" cy=\"8\" r=\"4\" />\r\n        <path d=\"M12 14c-6 0-8 3-8 6v2h16v-2c0-3-2-6-8-6z\" />\r\n      </svg>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function CharacterAvatar({ \r\n  characterData, \r\n  size = 120, \r\n  className = \"\",\r\n  showPlaceholder = true \r\n}: CharacterAvatarProps) {\r\n  if (!characterData) {\r\n    if (showPlaceholder) {\r\n      return <PlaceholderAvatar size={size} />;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  const { character, baseBody, equippedAccessories } = characterData;\r\n  \r\n  const sortedAccessories = [...equippedAccessories]\r\n    .filter(ua => ua.accessory)\r\n    .sort((a, b) => (a.accessory?.zIndex || 0) - (b.accessory?.zIndex || 0));\r\n\r\n  // Editor uses 300x400 canvas. For square avatar containers with object-contain,\r\n  // the 4:3 aspect ratio image is limited by height, creating horizontal letterbox.\r\n  // Scale by height: size/400, horizontal offset: (size - 300*scaleRatio)/2\r\n  const scaleRatio = size / 400;\r\n  const scaledWidth = 300 * scaleRatio;\r\n  const offsetX = (size - scaledWidth) / 2;\r\n  \r\n  return (\r\n    <div \r\n      className={`relative overflow-hidden ${className}`}\r\n      style={{ width: size, height: size }}\r\n      data-testid=\"character-avatar\"\r\n    >\r\n      {baseBody && (\r\n        <img\r\n          src={baseBody.imageUrl}\r\n          alt=\"Базовое тело\"\r\n          className=\"absolute inset-0 w-full h-full object-contain\"\r\n          style={{ zIndex: 0 }}\r\n          data-testid=\"character-base-body\"\r\n        />\r\n      )}\r\n      \r\n      {!baseBody && (\r\n        <PlaceholderAvatar \r\n          gender={character.gender as 'male' | 'female'} \r\n          size={size} \r\n        />\r\n      )}\r\n      \r\n      {sortedAccessories.map((userAccessory) => {\r\n        const accessory = userAccessory.accessory;\r\n        if (!accessory) return null;\r\n        \r\n        // Scale positions from 300x400 canvas to fit in square container with letterbox offset\r\n        const posX = accessory.positionX * scaleRatio + offsetX;\r\n        const posY = accessory.positionY * scaleRatio;\r\n        const accScale = parseFloat(String(accessory.scale || '1'));\r\n        // Accessory images in editor are 80px base size * scale\r\n        const imgSize = 80 * accScale * scaleRatio;\r\n        \r\n        return (\r\n          <img\r\n            key={userAccessory.id}\r\n            src={accessory.imageUrl}\r\n            alt={accessory.nameRu}\r\n            className=\"absolute object-contain\"\r\n            style={{\r\n              zIndex: accessory.zIndex,\r\n              left: posX,\r\n              top: posY,\r\n              width: imgSize,\r\n              height: imgSize,\r\n            }}\r\n            data-testid={`character-accessory-${accessory.id}`}\r\n          />\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface CharacterAvatarPreviewProps {\r\n  baseBody: BaseBody | null;\r\n  accessories: Accessory[];\r\n  size?: number;\r\n  className?: string;\r\n}\r\n\r\nexport function CharacterAvatarPreview({\r\n  baseBody,\r\n  accessories,\r\n  size = 120,\r\n  className = \"\",\r\n}: CharacterAvatarPreviewProps) {\r\n  const sortedAccessories = [...accessories].sort((a, b) => a.zIndex - b.zIndex);\r\n  \r\n  // Editor uses 300x400 canvas. For square avatar containers with object-contain,\r\n  // the 4:3 aspect ratio image is limited by height, creating horizontal letterbox.\r\n  const scaleRatio = size / 400;\r\n  const scaledWidth = 300 * scaleRatio;\r\n  const offsetX = (size - scaledWidth) / 2;\r\n\r\n  return (\r\n    <div \r\n      className={`relative overflow-hidden ${className}`}\r\n      style={{ width: size, height: size }}\r\n      data-testid=\"character-avatar-preview\"\r\n    >\r\n      {baseBody && (\r\n        <img\r\n          src={baseBody.imageUrl}\r\n          alt=\"Базовое тело\"\r\n          className=\"absolute inset-0 w-full h-full object-contain\"\r\n          style={{ zIndex: 0 }}\r\n          data-testid=\"preview-base-body\"\r\n        />\r\n      )}\r\n      \r\n      {sortedAccessories.map((accessory) => {\r\n        // Scale positions from 300x400 canvas to fit in square container with letterbox offset\r\n        const posX = accessory.positionX * scaleRatio + offsetX;\r\n        const posY = accessory.positionY * scaleRatio;\r\n        const accScale = parseFloat(String(accessory.scale || '1'));\r\n        // Accessory images in editor are 80px base size * scale\r\n        const imgSize = 80 * accScale * scaleRatio;\r\n        \r\n        return (\r\n          <img\r\n            key={accessory.id}\r\n            src={accessory.imageUrl}\r\n            alt={accessory.nameRu}\r\n            className=\"absolute object-contain\"\r\n            style={{\r\n              zIndex: accessory.zIndex,\r\n              left: posX,\r\n              top: posY,\r\n              width: imgSize,\r\n              height: imgSize,\r\n            }}\r\n            data-testid={`preview-accessory-${accessory.id}`}\r\n          />\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 219, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/CharacterSetup.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport { useMutation } from \"@tanstack/react-query\";\r\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Loader2, User, UserRound } from \"lucide-react\";\r\n\r\ntype CharacterGender = 'male' | 'female';\r\n\r\ninterface CharacterSetupProps {\r\n  onComplete: () => void;\r\n}\r\n\r\nexport function CharacterSetup({ onComplete }: CharacterSetupProps) {\r\n  const [step, setStep] = useState<'gender' | 'name'>('gender');\r\n  const [gender, setGender] = useState<CharacterGender | null>(null);\r\n  const [name, setName] = useState('');\r\n  const [error, setError] = useState('');\r\n\r\n  const setupMutation = useMutation({\r\n    mutationFn: async (data: { gender: CharacterGender; name: string }) => {\r\n      return apiRequest('POST', '/api/character/setup', data);\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['/api/character/status'] });\r\n      onComplete();\r\n    },\r\n    onError: (err: any) => {\r\n      setError(err.message || 'Ошибка при создании персонажа');\r\n    },\r\n  });\r\n\r\n  const handleGenderSelect = (selected: CharacterGender) => {\r\n    setGender(selected);\r\n    setStep('name');\r\n  };\r\n\r\n  const handleSubmit = () => {\r\n    if (!gender) return;\r\n    \r\n    const trimmedName = name.trim();\r\n    if (trimmedName.length < 1) {\r\n      setError('Введите имя персонажа');\r\n      return;\r\n    }\r\n    if (trimmedName.length > 50) {\r\n      setError('Имя слишком длинное');\r\n      return;\r\n    }\r\n\r\n    setError('');\r\n    setupMutation.mutate({ gender, name: trimmedName });\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n      <motion.div\r\n        initial={{ opacity: 0, scale: 0.9 }}\r\n        animate={{ opacity: 1, scale: 1 }}\r\n        className=\"w-full max-w-md\"\r\n      >\r\n        <Card className=\"border-2\">\r\n          <CardHeader className=\"text-center\">\r\n            <CardTitle className=\"text-xl\">Создай своего персонажа</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {step === 'gender' && (\r\n              <motion.div\r\n                initial={{ opacity: 0, x: -20 }}\r\n                animate={{ opacity: 1, x: 0 }}\r\n                className=\"space-y-4\"\r\n              >\r\n                <p className=\"text-center text-muted-foreground mb-6\">\r\n                  Выбери пол персонажа\r\n                </p>\r\n                <div className=\"flex gap-4 justify-center\">\r\n                  <motion.button\r\n                    whileHover={{ scale: 1.05 }}\r\n                    whileTap={{ scale: 0.95 }}\r\n                    onClick={() => handleGenderSelect('male')}\r\n                    className=\"flex flex-col items-center p-6 rounded-xl bg-blue-100 dark:bg-blue-900/30 hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors border-2 border-transparent hover:border-blue-400\"\r\n                    data-testid=\"select-gender-male\"\r\n                  >\r\n                    <div className=\"w-16 h-16 rounded-full bg-blue-400 flex items-center justify-center mb-2\">\r\n                      <User className=\"w-10 h-10 text-white\" />\r\n                    </div>\r\n                    <span className=\"font-medium text-blue-700 dark:text-blue-300\">Он</span>\r\n                  </motion.button>\r\n                  <motion.button\r\n                    whileHover={{ scale: 1.05 }}\r\n                    whileTap={{ scale: 0.95 }}\r\n                    onClick={() => handleGenderSelect('female')}\r\n                    className=\"flex flex-col items-center p-6 rounded-xl bg-pink-100 dark:bg-pink-900/30 hover:bg-pink-200 dark:hover:bg-pink-900/50 transition-colors border-2 border-transparent hover:border-pink-400\"\r\n                    data-testid=\"select-gender-female\"\r\n                  >\r\n                    <div className=\"w-16 h-16 rounded-full bg-pink-400 flex items-center justify-center mb-2\">\r\n                      <UserRound className=\"w-10 h-10 text-white\" />\r\n                    </div>\r\n                    <span className=\"font-medium text-pink-700 dark:text-pink-300\">Она</span>\r\n                  </motion.button>\r\n                </div>\r\n              </motion.div>\r\n            )}\r\n\r\n            {step === 'name' && gender && (\r\n              <motion.div\r\n                initial={{ opacity: 0, x: 20 }}\r\n                animate={{ opacity: 1, x: 0 }}\r\n                className=\"space-y-4\"\r\n              >\r\n                <div className=\"flex justify-center mb-4\">\r\n                  <div className={`w-20 h-20 rounded-full flex items-center justify-center ${\r\n                    gender === 'male' \r\n                      ? 'bg-gradient-to-b from-blue-400 to-blue-500' \r\n                      : 'bg-gradient-to-b from-pink-400 to-pink-500'\r\n                  }`}>\r\n                    {gender === 'male' \r\n                      ? <User className=\"w-12 h-12 text-white\" />\r\n                      : <UserRound className=\"w-12 h-12 text-white\" />\r\n                    }\r\n                  </div>\r\n                </div>\r\n                \r\n                <p className=\"text-center text-muted-foreground\">\r\n                  Как зовут твоего персонажа?\r\n                </p>\r\n\r\n                <Input\r\n                  value={name}\r\n                  onChange={(e) => setName(e.target.value)}\r\n                  placeholder=\"Введи имя...\"\r\n                  maxLength={50}\r\n                  className=\"text-center text-lg\"\r\n                  data-testid=\"input-character-name\"\r\n                />\r\n\r\n                {error && (\r\n                  <p className=\"text-sm text-red-500 text-center\">{error}</p>\r\n                )}\r\n\r\n                <div className=\"flex gap-2\">\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    onClick={() => setStep('gender')}\r\n                    className=\"flex-1\"\r\n                    data-testid=\"button-back-to-gender\"\r\n                  >\r\n                    Назад\r\n                  </Button>\r\n                  <Button\r\n                    onClick={handleSubmit}\r\n                    disabled={setupMutation.isPending || !name.trim()}\r\n                    className=\"flex-1\"\r\n                    data-testid=\"button-create-character\"\r\n                  >\r\n                    {setupMutation.isPending ? (\r\n                      <>\r\n                        <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                        Создание...\r\n                      </>\r\n                    ) : (\r\n                      'Создать'\r\n                    )}\r\n                  </Button>\r\n                </div>\r\n              </motion.div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 589, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/LeagueBadge.tsx"],"sourcesContent":["import { useQuery } from '@tanstack/react-query';\r\nimport { motion } from 'framer-motion';\r\nimport { Link } from 'wouter';\r\nimport { Loader2, ChevronRight } from 'lucide-react';\r\n\r\ninterface League {\r\n  id: string;\r\n  slug: string;\r\n  nameRu: string;\r\n  nameEn: string;\r\n  icon: string;\r\n  minBeads: number;\r\n  maxRank: number | null;\r\n  themeColor: string;\r\n  sortOrder: number;\r\n}\r\n\r\ninterface UserLeagueResponse {\r\n  league: League;\r\n  rank: number;\r\n}\r\n\r\ninterface LeagueBadgeProps {\r\n  size?: 'sm' | 'md' | 'lg';\r\n  showRank?: boolean;\r\n  className?: string;\r\n}\r\n\r\nexport function LeagueBadge({ size = 'md', showRank = true, className = '' }: LeagueBadgeProps) {\r\n  const { data: userLeague, isLoading } = useQuery<UserLeagueResponse>({\r\n    queryKey: ['/api/user/league'],\r\n    staleTime: 30000,\r\n  });\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className={`flex items-center gap-1.5 ${className}`}>\r\n        <Loader2 className=\"w-4 h-4 animate-spin text-muted-foreground\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!userLeague) {\r\n    return null;\r\n  }\r\n\r\n  const { league, rank } = userLeague;\r\n  \r\n  const sizeClasses = {\r\n    sm: { container: 'px-2 py-0.5 text-xs', icon: 'text-sm' },\r\n    md: { container: 'px-2.5 py-1 text-sm', icon: 'text-base' },\r\n    lg: { container: 'px-3 py-1.5 text-base', icon: 'text-lg' },\r\n  };\r\n\r\n  const sizes = sizeClasses[size];\r\n\r\n  return (\r\n    <Link href={`/league/${league.slug}`}>\r\n      <motion.div\r\n        initial={{ opacity: 0, scale: 0.9 }}\r\n        animate={{ opacity: 1, scale: 1 }}\r\n        whileHover={{ scale: 1.05 }}\r\n        whileTap={{ scale: 0.95 }}\r\n        className={`inline-flex items-center gap-1.5 rounded-full font-medium cursor-pointer ${sizes.container} ${className}`}\r\n        style={{\r\n          background: `linear-gradient(135deg, ${league.themeColor}20 0%, ${league.themeColor}40 100%)`,\r\n          border: `1px solid ${league.themeColor}60`,\r\n          color: league.themeColor,\r\n          textShadow: `0 0 10px ${league.themeColor}50`,\r\n        }}\r\n        data-testid=\"badge-user-league\"\r\n      >\r\n        <span className={sizes.icon}>{league.icon}</span>\r\n        <span>{league.nameRu}</span>\r\n        {showRank && (\r\n          <span \r\n            className=\"opacity-70 text-xs\"\r\n            style={{ color: league.themeColor }}\r\n          >\r\n            #{rank}\r\n          </span>\r\n        )}\r\n        <ChevronRight className=\"w-3 h-3 opacity-60\" />\r\n      </motion.div>\r\n    </Link>\r\n  );\r\n}\r\n\r\nexport function LeagueCard({ className = '' }: { className?: string }) {\r\n  const { data: userLeague, isLoading } = useQuery<UserLeagueResponse>({\r\n    queryKey: ['/api/user/league'],\r\n    staleTime: 30000,\r\n  });\r\n\r\n  const { data: allLeagues = [] } = useQuery<League[]>({\r\n    queryKey: ['/api/leagues'],\r\n    staleTime: 60000,\r\n  });\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className={`p-4 rounded-lg bg-card animate-pulse ${className}`}>\r\n        <div className=\"h-20 bg-muted rounded\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!userLeague) {\r\n    return null;\r\n  }\r\n\r\n  const { league, rank } = userLeague;\r\n  const currentIndex = allLeagues.findIndex(l => l.slug === league.slug);\r\n  const nextLeague = currentIndex < allLeagues.length - 1 ? allLeagues[currentIndex + 1] : null;\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, y: 10 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      className={`p-4 rounded-lg ${className}`}\r\n      style={{\r\n        background: `linear-gradient(135deg, ${league.themeColor}15 0%, ${league.themeColor}05 100%)`,\r\n        border: `1px solid ${league.themeColor}30`,\r\n      }}\r\n      data-testid=\"card-league-info\"\r\n    >\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <div \r\n            className=\"w-12 h-12 rounded-full flex items-center justify-center text-2xl\"\r\n            style={{\r\n              background: `linear-gradient(135deg, ${league.themeColor}30 0%, ${league.themeColor}10 100%)`,\r\n              border: `2px solid ${league.themeColor}`,\r\n              boxShadow: `0 0 20px ${league.themeColor}40`,\r\n            }}\r\n          >\r\n            {league.icon}\r\n          </div>\r\n          <div>\r\n            <h3 \r\n              className=\"font-bold text-lg\"\r\n              style={{ color: league.themeColor }}\r\n            >\r\n              {league.nameRu} лига\r\n            </h3>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Ранг: #{rank} {league.maxRank ? `из топ-${league.maxRank}` : ''}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {nextLeague && (\r\n        <div className=\"mt-3 pt-3 border-t border-border/50\">\r\n          <div className=\"flex items-center justify-between text-sm\">\r\n            <span className=\"text-muted-foreground\">Следующая лига:</span>\r\n            <span \r\n              className=\"font-medium flex items-center gap-1\"\r\n              style={{ color: nextLeague.themeColor }}\r\n            >\r\n              {nextLeague.icon} {nextLeague.nameRu}\r\n            </span>\r\n          </div>\r\n          <p className=\"text-xs text-muted-foreground mt-1\">\r\n            Требуется: {nextLeague.minBeads.toLocaleString()} Beads\r\n            {nextLeague.maxRank ? ` и топ-${nextLeague.maxRank}` : ''}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </motion.div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AAAA;;;;;;;AAyBO,SAAS,YAAY,EAAE,OAAO,IAAI,EAAE,WAAW,IAAI,EAAE,YAAY,EAAE,EAAoB;;IAC5F,MAAM,EAAE,MAAM,UAAU,EAAE,SAAS,EAAE,GAAG,IAAA,mLAAQ,EAAqB;QACnE,UAAU;YAAC;SAAmB;QAC9B,WAAW;IACb;IAEA,IAAI,WAAW;QACb,qBACE,0JAAC;YAAI,WAAW,CAAC,0BAA0B,EAAE,WAAW;sBACtD,cAAA,0JAAC,wNAAO;gBAAC,WAAU;;;;;;;;;;;IAGzB;IAEA,IAAI,CAAC,YAAY;QACf,OAAO;IACT;IAEA,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG;IAEzB,MAAM,cAAc;QAClB,IAAI;YAAE,WAAW;YAAuB,MAAM;QAAU;QACxD,IAAI;YAAE,WAAW;YAAuB,MAAM;QAAY;QAC1D,IAAI;YAAE,WAAW;YAAyB,MAAM;QAAU;IAC5D;IAEA,MAAM,QAAQ,WAAW,CAAC,KAAK;IAE/B,qBACE,0JAAC,0IAAI;QAAC,MAAM,CAAC,QAAQ,EAAE,OAAO,IAAI,EAAE;kBAClC,cAAA,0JAAC,gMAAM,CAAC,GAAG;YACT,SAAS;gBAAE,SAAS;gBAAG,OAAO;YAAI;YAClC,SAAS;gBAAE,SAAS;gBAAG,OAAO;YAAE;YAChC,YAAY;gBAAE,OAAO;YAAK;YAC1B,UAAU;gBAAE,OAAO;YAAK;YACxB,WAAW,CAAC,yEAAyE,EAAE,MAAM,SAAS,CAAC,CAAC,EAAE,WAAW;YACrH,OAAO;gBACL,YAAY,CAAC,wBAAwB,EAAE,OAAO,UAAU,CAAC,OAAO,EAAE,OAAO,UAAU,CAAC,QAAQ,CAAC;gBAC7F,QAAQ,CAAC,UAAU,EAAE,OAAO,UAAU,CAAC,EAAE,CAAC;gBAC1C,OAAO,OAAO,UAAU;gBACxB,YAAY,CAAC,SAAS,EAAE,OAAO,UAAU,CAAC,EAAE,CAAC;YAC/C;YACA,eAAY;;8BAEZ,0JAAC;oBAAK,WAAW,MAAM,IAAI;8BAAG,OAAO,IAAI;;;;;;8BACzC,0JAAC;8BAAM,OAAO,MAAM;;;;;;gBACnB,0BACC,0JAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,OAAO,OAAO,UAAU;oBAAC;;wBACnC;wBACG;;;;;;;8BAGN,0JAAC,kOAAY;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAIhC;GA1DgB;;QAC0B,mLAAQ;;;KADlC;AA4DT,SAAS,WAAW,EAAE,YAAY,EAAE,EAA0B;;IACnE,MAAM,EAAE,MAAM,UAAU,EAAE,SAAS,EAAE,GAAG,IAAA,mLAAQ,EAAqB;QACnE,UAAU;YAAC;SAAmB;QAC9B,WAAW;IACb;IAEA,MAAM,EAAE,MAAM,aAAa,EAAE,EAAE,GAAG,IAAA,mLAAQ,EAAW;QACnD,UAAU;YAAC;SAAe;QAC1B,WAAW;IACb;IAEA,IAAI,WAAW;QACb,qBACE,0JAAC;YAAI,WAAW,CAAC,qCAAqC,EAAE,WAAW;sBACjE,cAAA,0JAAC;gBAAI,WAAU;;;;;;;;;;;IAGrB;IAEA,IAAI,CAAC,YAAY;QACf,OAAO;IACT;IAEA,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG;IACzB,MAAM,eAAe,WAAW,SAAS,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,OAAO,IAAI;IACrE,MAAM,aAAa,eAAe,WAAW,MAAM,GAAG,IAAI,UAAU,CAAC,eAAe,EAAE,GAAG;IAEzF,qBACE,0JAAC,gMAAM,CAAC,GAAG;QACT,SAAS;YAAE,SAAS;YAAG,GAAG;QAAG;QAC7B,SAAS;YAAE,SAAS;YAAG,GAAG;QAAE;QAC5B,WAAW,CAAC,eAAe,EAAE,WAAW;QACxC,OAAO;YACL,YAAY,CAAC,wBAAwB,EAAE,OAAO,UAAU,CAAC,OAAO,EAAE,OAAO,UAAU,CAAC,QAAQ,CAAC;YAC7F,QAAQ,CAAC,UAAU,EAAE,OAAO,UAAU,CAAC,EAAE,CAAC;QAC5C;QACA,eAAY;;0BAEZ,0JAAC;gBAAI,WAAU;0BACb,cAAA,0JAAC;oBAAI,WAAU;;sCACb,0JAAC;4BACC,WAAU;4BACV,OAAO;gCACL,YAAY,CAAC,wBAAwB,EAAE,OAAO,UAAU,CAAC,OAAO,EAAE,OAAO,UAAU,CAAC,QAAQ,CAAC;gCAC7F,QAAQ,CAAC,UAAU,EAAE,OAAO,UAAU,EAAE;gCACxC,WAAW,CAAC,SAAS,EAAE,OAAO,UAAU,CAAC,EAAE,CAAC;4BAC9C;sCAEC,OAAO,IAAI;;;;;;sCAEd,0JAAC;;8CACC,0JAAC;oCACC,WAAU;oCACV,OAAO;wCAAE,OAAO,OAAO,UAAU;oCAAC;;wCAEjC,OAAO,MAAM;wCAAC;;;;;;;8CAEjB,0JAAC;oCAAE,WAAU;;wCAAgC;wCACnC;wCAAK;wCAAE,OAAO,OAAO,GAAG,CAAC,OAAO,EAAE,OAAO,OAAO,EAAE,GAAG;;;;;;;;;;;;;;;;;;;;;;;;YAMpE,4BACC,0JAAC;gBAAI,WAAU;;kCACb,0JAAC;wBAAI,WAAU;;0CACb,0JAAC;gCAAK,WAAU;0CAAwB;;;;;;0CACxC,0JAAC;gCACC,WAAU;gCACV,OAAO;oCAAE,OAAO,WAAW,UAAU;gCAAC;;oCAErC,WAAW,IAAI;oCAAC;oCAAE,WAAW,MAAM;;;;;;;;;;;;;kCAGxC,0JAAC;wBAAE,WAAU;;4BAAqC;4BACpC,WAAW,QAAQ,CAAC,cAAc;4BAAG;4BAChD,WAAW,OAAO,GAAG,CAAC,OAAO,EAAE,WAAW,OAAO,EAAE,GAAG;;;;;;;;;;;;;;;;;;;AAMnE;IAnFgB;;QAC0B,mLAAQ;QAKd,mLAAQ;;;MAN5B"}},
    {"offset": {"line": 924, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/GameCanvas.tsx"],"sourcesContent":["import { useRef, useEffect, useCallback } from 'react';\r\nimport type { Ball, GameState } from '@shared/schema';\r\nimport {\r\n  BALL_COLOR_MAP,\r\n  CRYPTO_COLOR_MAP,\r\n  CRYPTO_SYMBOL_MAP,\r\n  BALL_RADIUS,\r\n  type PathPoint,\r\n} from '@/lib/gameEngine';\r\n\r\ninterface GameCanvasProps {\r\n  gameState: GameState;\r\n  path: PathPoint[];\r\n  projectile: { x: number; y: number; ball: Ball } | null;\r\n  shooterAngle: number;\r\n  shooterPosition: { x: number; y: number };\r\n  onShoot: (x: number, y: number) => void;\r\n  onAim: (x: number, y: number) => void;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport function GameCanvas({\r\n  gameState,\r\n  path,\r\n  projectile,\r\n  shooterAngle,\r\n  shooterPosition,\r\n  onShoot,\r\n  onAim,\r\n  width,\r\n  height,\r\n}: GameCanvasProps) {\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const animationFrameRef = useRef<number>();\r\n\r\n  const portalAnimationRef = useRef(0);\r\n  \r\n  const drawPath = useCallback((ctx: CanvasRenderingContext2D) => {\r\n    if (path.length < 2) return;\r\n    \r\n    ctx.beginPath();\r\n    ctx.strokeStyle = 'rgba(139, 92, 246, 0.25)';\r\n    ctx.lineWidth = BALL_RADIUS * 2.5;\r\n    ctx.lineCap = 'round';\r\n    ctx.lineJoin = 'round';\r\n    \r\n    ctx.moveTo(path[0].x, path[0].y);\r\n    for (let i = 1; i < path.length; i++) {\r\n      ctx.lineTo(path[i].x, path[i].y);\r\n    }\r\n    ctx.stroke();\r\n    \r\n    ctx.beginPath();\r\n    ctx.strokeStyle = 'rgba(139, 92, 246, 0.12)';\r\n    ctx.lineWidth = BALL_RADIUS * 3;\r\n    ctx.moveTo(path[0].x, path[0].y);\r\n    for (let i = 1; i < path.length; i++) {\r\n      ctx.lineTo(path[i].x, path[i].y);\r\n    }\r\n    ctx.stroke();\r\n    \r\n    ctx.beginPath();\r\n    ctx.strokeStyle = 'rgba(168, 85, 247, 0.4)';\r\n    ctx.lineWidth = 2;\r\n    ctx.moveTo(path[0].x, path[0].y);\r\n    for (let i = 1; i < path.length; i++) {\r\n      ctx.lineTo(path[i].x, path[i].y);\r\n    }\r\n    ctx.stroke();\r\n    \r\n    portalAnimationRef.current = (portalAnimationRef.current + 0.05) % (Math.PI * 4);\r\n    \r\n    if (path.length > 0) {\r\n      const startPoint = path[0];\r\n      const spawnPulse = 1 + Math.sin(portalAnimationRef.current * 1.5) * 0.2;\r\n      const spawnRadius = BALL_RADIUS * 2.5 * spawnPulse;\r\n      \r\n      const spawnGradient = ctx.createRadialGradient(\r\n        startPoint.x, startPoint.y, 0,\r\n        startPoint.x, startPoint.y, spawnRadius\r\n      );\r\n      spawnGradient.addColorStop(0, 'rgba(59, 130, 246, 0.9)');\r\n      spawnGradient.addColorStop(0.4, 'rgba(99, 102, 241, 0.6)');\r\n      spawnGradient.addColorStop(1, 'rgba(139, 92, 246, 0)');\r\n      \r\n      ctx.beginPath();\r\n      ctx.arc(startPoint.x, startPoint.y, spawnRadius, 0, Math.PI * 2);\r\n      ctx.fillStyle = spawnGradient;\r\n      ctx.fill();\r\n      \r\n      ctx.beginPath();\r\n      ctx.arc(startPoint.x, startPoint.y, BALL_RADIUS * 1.5, 0, Math.PI * 2);\r\n      ctx.strokeStyle = 'rgba(59, 130, 246, 0.8)';\r\n      ctx.lineWidth = 3;\r\n      ctx.stroke();\r\n      \r\n      ctx.save();\r\n      ctx.translate(startPoint.x, startPoint.y);\r\n      for (let i = 0; i < 8; i++) {\r\n        ctx.rotate(Math.PI / 4);\r\n        ctx.beginPath();\r\n        ctx.moveTo(BALL_RADIUS * 0.5, 0);\r\n        ctx.lineTo(BALL_RADIUS * 1.2, 0);\r\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';\r\n        ctx.lineWidth = 2;\r\n        ctx.stroke();\r\n      }\r\n      ctx.restore();\r\n    }\r\n    \r\n    if (path.length > 0) {\r\n      const endPoint = path[path.length - 1];\r\n      const pulseScale = 1 + Math.sin(portalAnimationRef.current) * 0.15;\r\n      const portalRadius = BALL_RADIUS * 2 * pulseScale;\r\n      \r\n      const portalGradient = ctx.createRadialGradient(\r\n        endPoint.x, endPoint.y, 0,\r\n        endPoint.x, endPoint.y, portalRadius\r\n      );\r\n      portalGradient.addColorStop(0, 'rgba(239, 68, 68, 0.9)');\r\n      portalGradient.addColorStop(0.5, 'rgba(220, 38, 38, 0.6)');\r\n      portalGradient.addColorStop(1, 'rgba(185, 28, 28, 0)');\r\n      \r\n      ctx.beginPath();\r\n      ctx.arc(endPoint.x, endPoint.y, portalRadius, 0, Math.PI * 2);\r\n      ctx.fillStyle = portalGradient;\r\n      ctx.fill();\r\n      \r\n      ctx.beginPath();\r\n      ctx.arc(endPoint.x, endPoint.y, BALL_RADIUS * 1.2, 0, Math.PI * 2);\r\n      ctx.strokeStyle = 'rgba(239, 68, 68, 0.8)';\r\n      ctx.lineWidth = 3;\r\n      ctx.stroke();\r\n      \r\n      ctx.save();\r\n      ctx.translate(endPoint.x, endPoint.y);\r\n      for (let i = 0; i < 6; i++) {\r\n        ctx.rotate(Math.PI / 3);\r\n        ctx.beginPath();\r\n        ctx.moveTo(BALL_RADIUS * 0.3, 0);\r\n        ctx.lineTo(BALL_RADIUS * 0.8, 0);\r\n        ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';\r\n        ctx.lineWidth = 2;\r\n        ctx.stroke();\r\n      }\r\n      ctx.restore();\r\n    }\r\n  }, [path]);\r\n\r\n  const drawBall = useCallback((ctx: CanvasRenderingContext2D, ball: Ball, isShooter: boolean = false) => {\r\n    const progress = ball.pathProgress || 0;\r\n    \r\n    if (progress < -0.03) return;\r\n    \r\n    const spawnOpacity = progress < 0 ? Math.max(0, 1 + (progress / 0.03)) : 1;\r\n    \r\n    const baseColor = ball.crypto ? CRYPTO_COLOR_MAP[ball.crypto] : BALL_COLOR_MAP[ball.color];\r\n    \r\n    const rollAngle = progress * Math.PI * 20;\r\n    \r\n    ctx.save();\r\n    ctx.globalAlpha = spawnOpacity;\r\n    ctx.translate(ball.x, ball.y);\r\n    \r\n    if (ball.isUsdtFund) {\r\n      const pulse = 1 + Math.sin(Date.now() * 0.008) * 0.15;\r\n      ctx.shadowColor = '#FFD700';\r\n      ctx.shadowBlur = 20 * pulse;\r\n      \r\n      ctx.beginPath();\r\n      ctx.arc(0, 0, BALL_RADIUS + 4, 0, Math.PI * 2);\r\n      ctx.strokeStyle = `rgba(255, 215, 0, ${0.4 + Math.sin(Date.now() * 0.01) * 0.3})`;\r\n      ctx.lineWidth = 3;\r\n      ctx.stroke();\r\n    } else if (ball.crypto) {\r\n      ctx.shadowColor = CRYPTO_COLOR_MAP[ball.crypto];\r\n      ctx.shadowBlur = 15;\r\n      ctx.beginPath();\r\n      ctx.arc(0, 0, BALL_RADIUS + 3, 0, Math.PI * 2);\r\n      ctx.strokeStyle = CRYPTO_COLOR_MAP[ball.crypto];\r\n      ctx.lineWidth = 3;\r\n      ctx.stroke();\r\n    }\r\n    \r\n    const gradient = ctx.createRadialGradient(\r\n      -BALL_RADIUS * 0.3,\r\n      -BALL_RADIUS * 0.3,\r\n      0,\r\n      0,\r\n      0,\r\n      BALL_RADIUS\r\n    );\r\n    \r\n    gradient.addColorStop(0, lightenColor(baseColor, 40));\r\n    gradient.addColorStop(0.5, baseColor);\r\n    gradient.addColorStop(1, darkenColor(baseColor, 20));\r\n    \r\n    ctx.beginPath();\r\n    ctx.arc(0, 0, BALL_RADIUS, 0, Math.PI * 2);\r\n    ctx.fillStyle = gradient;\r\n    ctx.fill();\r\n    \r\n    ctx.strokeStyle = darkenColor(baseColor, 30);\r\n    ctx.lineWidth = 2;\r\n    ctx.stroke();\r\n    ctx.shadowBlur = 0;\r\n    \r\n    if (!isShooter) {\r\n      ctx.rotate(rollAngle);\r\n      \r\n      ctx.beginPath();\r\n      ctx.arc(0, -BALL_RADIUS * 0.5, BALL_RADIUS * 0.15, 0, Math.PI * 2);\r\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';\r\n      ctx.fill();\r\n      \r\n      ctx.beginPath();\r\n      ctx.arc(0, BALL_RADIUS * 0.5, BALL_RADIUS * 0.12, 0, Math.PI * 2);\r\n      ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';\r\n      ctx.fill();\r\n      \r\n      ctx.rotate(-rollAngle);\r\n    }\r\n    \r\n    if (ball.isUsdtFund) {\r\n      ctx.fillStyle = '#1a1a1a';\r\n      ctx.font = `bold ${BALL_RADIUS * 1.1}px Inter, sans-serif`;\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'middle';\r\n      ctx.fillText('$', 0, 1);\r\n      \r\n      ctx.fillStyle = '#FFD700';\r\n      ctx.font = `bold ${BALL_RADIUS * 1.0}px Inter, sans-serif`;\r\n      ctx.fillText('$', 0, 0);\r\n    } else if (ball.crypto) {\r\n      ctx.fillStyle = '#ffffff';\r\n      ctx.font = `bold ${BALL_RADIUS}px Inter, sans-serif`;\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'middle';\r\n      ctx.fillText(CRYPTO_SYMBOL_MAP[ball.crypto], 0, 0);\r\n    }\r\n    \r\n    ctx.beginPath();\r\n    ctx.arc(\r\n      -BALL_RADIUS * 0.35,\r\n      -BALL_RADIUS * 0.35,\r\n      BALL_RADIUS * 0.25,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\r\n    ctx.fill();\r\n    \r\n    ctx.restore();\r\n  }, []);\r\n\r\n  const drawShooter = useCallback((ctx: CanvasRenderingContext2D) => {\r\n    const { x, y } = shooterPosition;\r\n    \r\n    ctx.save();\r\n    ctx.translate(x, y);\r\n    ctx.rotate(shooterAngle);\r\n    \r\n    const shooterGradient = ctx.createLinearGradient(0, -15, 50, -15);\r\n    shooterGradient.addColorStop(0, '#6366f1');\r\n    shooterGradient.addColorStop(1, '#8b5cf6');\r\n    \r\n    ctx.beginPath();\r\n    ctx.roundRect(-10, -15, 60, 30, 5);\r\n    ctx.fillStyle = shooterGradient;\r\n    ctx.fill();\r\n    ctx.strokeStyle = '#4f46e5';\r\n    ctx.lineWidth = 2;\r\n    ctx.stroke();\r\n    \r\n    ctx.restore();\r\n    \r\n    ctx.beginPath();\r\n    ctx.arc(x, y, 30, 0, Math.PI * 2);\r\n    const baseGradient = ctx.createRadialGradient(x, y, 0, x, y, 30);\r\n    baseGradient.addColorStop(0, '#818cf8');\r\n    baseGradient.addColorStop(1, '#4f46e5');\r\n    ctx.fillStyle = baseGradient;\r\n    ctx.fill();\r\n    ctx.strokeStyle = '#3730a3';\r\n    ctx.lineWidth = 3;\r\n    ctx.stroke();\r\n    \r\n    if (gameState.shooterBall) {\r\n      drawBall(ctx, { ...gameState.shooterBall, x, y }, true);\r\n    }\r\n    \r\n    ctx.save();\r\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';\r\n    ctx.lineWidth = 2;\r\n    ctx.setLineDash([8, 8]);\r\n    ctx.beginPath();\r\n    ctx.moveTo(x, y);\r\n    const aimLength = 100;\r\n    ctx.lineTo(\r\n      x + Math.cos(shooterAngle) * aimLength,\r\n      y + Math.sin(shooterAngle) * aimLength\r\n    );\r\n    ctx.stroke();\r\n    ctx.restore();\r\n  }, [shooterPosition, shooterAngle, gameState.shooterBall, drawBall]);\r\n\r\n  const drawProjectile = useCallback((ctx: CanvasRenderingContext2D) => {\r\n    if (!projectile) return;\r\n    drawBall(ctx, { ...projectile.ball, x: projectile.x, y: projectile.y });\r\n  }, [projectile, drawBall]);\r\n\r\n  const draw = useCallback(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n    \r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return;\r\n    \r\n    ctx.clearRect(0, 0, width, height);\r\n    \r\n    drawPath(ctx);\r\n    \r\n    for (const ball of gameState.balls) {\r\n      drawBall(ctx, ball);\r\n    }\r\n    \r\n    drawProjectile(ctx);\r\n    \r\n    drawShooter(ctx);\r\n    \r\n    animationFrameRef.current = requestAnimationFrame(draw);\r\n  }, [width, height, gameState.balls, drawPath, drawBall, drawProjectile, drawShooter]);\r\n\r\n  useEffect(() => {\r\n    draw();\r\n    return () => {\r\n      if (animationFrameRef.current) {\r\n        cancelAnimationFrame(animationFrameRef.current);\r\n      }\r\n    };\r\n  }, [draw]);\r\n\r\n  const handleInteraction = useCallback((clientX: number, clientY: number, isClick: boolean) => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n    \r\n    const rect = canvas.getBoundingClientRect();\r\n    const x = (clientX - rect.left) * (width / rect.width);\r\n    const y = (clientY - rect.top) * (height / rect.height);\r\n    \r\n    if (isClick) {\r\n      onShoot(x, y);\r\n    } else {\r\n      onAim(x, y);\r\n    }\r\n  }, [width, height, onShoot, onAim]);\r\n\r\n  const handleClick = useCallback((e: React.MouseEvent<HTMLCanvasElement>) => {\r\n    handleInteraction(e.clientX, e.clientY, true);\r\n  }, [handleInteraction]);\r\n\r\n  const handleMouseMove = useCallback((e: React.MouseEvent<HTMLCanvasElement>) => {\r\n    handleInteraction(e.clientX, e.clientY, false);\r\n  }, [handleInteraction]);\r\n\r\n  const handleTouchStart = useCallback((e: React.TouchEvent<HTMLCanvasElement>) => {\r\n    e.preventDefault();\r\n    const touch = e.touches[0];\r\n    handleInteraction(touch.clientX, touch.clientY, false);\r\n  }, [handleInteraction]);\r\n\r\n  const handleTouchMove = useCallback((e: React.TouchEvent<HTMLCanvasElement>) => {\r\n    e.preventDefault();\r\n    const touch = e.touches[0];\r\n    handleInteraction(touch.clientX, touch.clientY, false);\r\n  }, [handleInteraction]);\r\n\r\n  const handleTouchEnd = useCallback((e: React.TouchEvent<HTMLCanvasElement>) => {\r\n    e.preventDefault();\r\n    if (e.changedTouches.length > 0) {\r\n      const touch = e.changedTouches[0];\r\n      handleInteraction(touch.clientX, touch.clientY, true);\r\n    }\r\n  }, [handleInteraction]);\r\n\r\n  return (\r\n    <canvas\r\n      ref={canvasRef}\r\n      width={width}\r\n      height={height}\r\n      onClick={handleClick}\r\n      onMouseMove={handleMouseMove}\r\n      onTouchStart={handleTouchStart}\r\n      onTouchMove={handleTouchMove}\r\n      onTouchEnd={handleTouchEnd}\r\n      className=\"touch-none cursor-crosshair\"\r\n      data-testid=\"game-canvas\"\r\n    />\r\n  );\r\n}\r\n\r\nfunction lightenColor(hex: string, percent: number): string {\r\n  const num = parseInt(hex.replace('#', ''), 16);\r\n  const amt = Math.round(2.55 * percent);\r\n  const R = Math.min(255, (num >> 16) + amt);\r\n  const G = Math.min(255, ((num >> 8) & 0x00ff) + amt);\r\n  const B = Math.min(255, (num & 0x0000ff) + amt);\r\n  return `#${(0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1)}`;\r\n}\r\n\r\nfunction darkenColor(hex: string, percent: number): string {\r\n  const num = parseInt(hex.replace('#', ''), 16);\r\n  const amt = Math.round(2.55 * percent);\r\n  const R = Math.max(0, (num >> 16) - amt);\r\n  const G = Math.max(0, ((num >> 8) & 0x00ff) - amt);\r\n  const B = Math.max(0, (num & 0x0000ff) - amt);\r\n  return `#${(0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1)}`;\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;;AAoBO,SAAS,WAAW,EACzB,SAAS,EACT,IAAI,EACJ,UAAU,EACV,YAAY,EACZ,eAAe,EACf,OAAO,EACP,KAAK,EACL,KAAK,EACL,MAAM,EACU;;IAChB,MAAM,YAAY,IAAA,oIAAM,EAAoB;IAC5C,MAAM,oBAAoB,IAAA,oIAAM;IAEhC,MAAM,qBAAqB,IAAA,oIAAM,EAAC;IAElC,MAAM,WAAW,IAAA,yIAAW;4CAAC,CAAC;YAC5B,IAAI,KAAK,MAAM,GAAG,GAAG;YAErB,IAAI,SAAS;YACb,IAAI,WAAW,GAAG;YAClB,IAAI,SAAS,GAAG,4HAAW,GAAG;YAC9B,IAAI,OAAO,GAAG;YACd,IAAI,QAAQ,GAAG;YAEf,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;YAC/B,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,MAAM,EAAE,IAAK;gBACpC,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;YACjC;YACA,IAAI,MAAM;YAEV,IAAI,SAAS;YACb,IAAI,WAAW,GAAG;YAClB,IAAI,SAAS,GAAG,4HAAW,GAAG;YAC9B,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;YAC/B,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,MAAM,EAAE,IAAK;gBACpC,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;YACjC;YACA,IAAI,MAAM;YAEV,IAAI,SAAS;YACb,IAAI,WAAW,GAAG;YAClB,IAAI,SAAS,GAAG;YAChB,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;YAC/B,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,MAAM,EAAE,IAAK;gBACpC,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;YACjC;YACA,IAAI,MAAM;YAEV,mBAAmB,OAAO,GAAG,CAAC,mBAAmB,OAAO,GAAG,IAAI,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC;YAE/E,IAAI,KAAK,MAAM,GAAG,GAAG;gBACnB,MAAM,aAAa,IAAI,CAAC,EAAE;gBAC1B,MAAM,aAAa,IAAI,KAAK,GAAG,CAAC,mBAAmB,OAAO,GAAG,OAAO;gBACpE,MAAM,cAAc,4HAAW,GAAG,MAAM;gBAExC,MAAM,gBAAgB,IAAI,oBAAoB,CAC5C,WAAW,CAAC,EAAE,WAAW,CAAC,EAAE,GAC5B,WAAW,CAAC,EAAE,WAAW,CAAC,EAAE;gBAE9B,cAAc,YAAY,CAAC,GAAG;gBAC9B,cAAc,YAAY,CAAC,KAAK;gBAChC,cAAc,YAAY,CAAC,GAAG;gBAE9B,IAAI,SAAS;gBACb,IAAI,GAAG,CAAC,WAAW,CAAC,EAAE,WAAW,CAAC,EAAE,aAAa,GAAG,KAAK,EAAE,GAAG;gBAC9D,IAAI,SAAS,GAAG;gBAChB,IAAI,IAAI;gBAER,IAAI,SAAS;gBACb,IAAI,GAAG,CAAC,WAAW,CAAC,EAAE,WAAW,CAAC,EAAE,4HAAW,GAAG,KAAK,GAAG,KAAK,EAAE,GAAG;gBACpE,IAAI,WAAW,GAAG;gBAClB,IAAI,SAAS,GAAG;gBAChB,IAAI,MAAM;gBAEV,IAAI,IAAI;gBACR,IAAI,SAAS,CAAC,WAAW,CAAC,EAAE,WAAW,CAAC;gBACxC,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IAAK;oBAC1B,IAAI,MAAM,CAAC,KAAK,EAAE,GAAG;oBACrB,IAAI,SAAS;oBACb,IAAI,MAAM,CAAC,4HAAW,GAAG,KAAK;oBAC9B,IAAI,MAAM,CAAC,4HAAW,GAAG,KAAK;oBAC9B,IAAI,WAAW,GAAG;oBAClB,IAAI,SAAS,GAAG;oBAChB,IAAI,MAAM;gBACZ;gBACA,IAAI,OAAO;YACb;YAEA,IAAI,KAAK,MAAM,GAAG,GAAG;gBACnB,MAAM,WAAW,IAAI,CAAC,KAAK,MAAM,GAAG,EAAE;gBACtC,MAAM,aAAa,IAAI,KAAK,GAAG,CAAC,mBAAmB,OAAO,IAAI;gBAC9D,MAAM,eAAe,4HAAW,GAAG,IAAI;gBAEvC,MAAM,iBAAiB,IAAI,oBAAoB,CAC7C,SAAS,CAAC,EAAE,SAAS,CAAC,EAAE,GACxB,SAAS,CAAC,EAAE,SAAS,CAAC,EAAE;gBAE1B,eAAe,YAAY,CAAC,GAAG;gBAC/B,eAAe,YAAY,CAAC,KAAK;gBACjC,eAAe,YAAY,CAAC,GAAG;gBAE/B,IAAI,SAAS;gBACb,IAAI,GAAG,CAAC,SAAS,CAAC,EAAE,SAAS,CAAC,EAAE,cAAc,GAAG,KAAK,EAAE,GAAG;gBAC3D,IAAI,SAAS,GAAG;gBAChB,IAAI,IAAI;gBAER,IAAI,SAAS;gBACb,IAAI,GAAG,CAAC,SAAS,CAAC,EAAE,SAAS,CAAC,EAAE,4HAAW,GAAG,KAAK,GAAG,KAAK,EAAE,GAAG;gBAChE,IAAI,WAAW,GAAG;gBAClB,IAAI,SAAS,GAAG;gBAChB,IAAI,MAAM;gBAEV,IAAI,IAAI;gBACR,IAAI,SAAS,CAAC,SAAS,CAAC,EAAE,SAAS,CAAC;gBACpC,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IAAK;oBAC1B,IAAI,MAAM,CAAC,KAAK,EAAE,GAAG;oBACrB,IAAI,SAAS;oBACb,IAAI,MAAM,CAAC,4HAAW,GAAG,KAAK;oBAC9B,IAAI,MAAM,CAAC,4HAAW,GAAG,KAAK;oBAC9B,IAAI,WAAW,GAAG;oBAClB,IAAI,SAAS,GAAG;oBAChB,IAAI,MAAM;gBACZ;gBACA,IAAI,OAAO;YACb;QACF;2CAAG;QAAC;KAAK;IAET,MAAM,WAAW,IAAA,yIAAW;4CAAC,CAAC,KAA+B,MAAY,YAAqB,KAAK;YACjG,MAAM,WAAW,KAAK,YAAY,IAAI;YAEtC,IAAI,WAAW,CAAC,MAAM;YAEtB,MAAM,eAAe,WAAW,IAAI,KAAK,GAAG,CAAC,GAAG,IAAK,WAAW,QAAS;YAEzE,MAAM,YAAY,KAAK,MAAM,GAAG,iIAAgB,CAAC,KAAK,MAAM,CAAC,GAAG,+HAAc,CAAC,KAAK,KAAK,CAAC;YAE1F,MAAM,YAAY,WAAW,KAAK,EAAE,GAAG;YAEvC,IAAI,IAAI;YACR,IAAI,WAAW,GAAG;YAClB,IAAI,SAAS,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC;YAE5B,IAAI,KAAK,UAAU,EAAE;gBACnB,MAAM,QAAQ,IAAI,KAAK,GAAG,CAAC,KAAK,GAAG,KAAK,SAAS;gBACjD,IAAI,WAAW,GAAG;gBAClB,IAAI,UAAU,GAAG,KAAK;gBAEtB,IAAI,SAAS;gBACb,IAAI,GAAG,CAAC,GAAG,GAAG,4HAAW,GAAG,GAAG,GAAG,KAAK,EAAE,GAAG;gBAC5C,IAAI,WAAW,GAAG,CAAC,kBAAkB,EAAE,MAAM,KAAK,GAAG,CAAC,KAAK,GAAG,KAAK,QAAQ,IAAI,CAAC,CAAC;gBACjF,IAAI,SAAS,GAAG;gBAChB,IAAI,MAAM;YACZ,OAAO,IAAI,KAAK,MAAM,EAAE;gBACtB,IAAI,WAAW,GAAG,iIAAgB,CAAC,KAAK,MAAM,CAAC;gBAC/C,IAAI,UAAU,GAAG;gBACjB,IAAI,SAAS;gBACb,IAAI,GAAG,CAAC,GAAG,GAAG,4HAAW,GAAG,GAAG,GAAG,KAAK,EAAE,GAAG;gBAC5C,IAAI,WAAW,GAAG,iIAAgB,CAAC,KAAK,MAAM,CAAC;gBAC/C,IAAI,SAAS,GAAG;gBAChB,IAAI,MAAM;YACZ;YAEA,MAAM,WAAW,IAAI,oBAAoB,CACvC,CAAC,4HAAW,GAAG,KACf,CAAC,4HAAW,GAAG,KACf,GACA,GACA,GACA,4HAAW;YAGb,SAAS,YAAY,CAAC,GAAG,aAAa,WAAW;YACjD,SAAS,YAAY,CAAC,KAAK;YAC3B,SAAS,YAAY,CAAC,GAAG,YAAY,WAAW;YAEhD,IAAI,SAAS;YACb,IAAI,GAAG,CAAC,GAAG,GAAG,4HAAW,EAAE,GAAG,KAAK,EAAE,GAAG;YACxC,IAAI,SAAS,GAAG;YAChB,IAAI,IAAI;YAER,IAAI,WAAW,GAAG,YAAY,WAAW;YACzC,IAAI,SAAS,GAAG;YAChB,IAAI,MAAM;YACV,IAAI,UAAU,GAAG;YAEjB,IAAI,CAAC,WAAW;gBACd,IAAI,MAAM,CAAC;gBAEX,IAAI,SAAS;gBACb,IAAI,GAAG,CAAC,GAAG,CAAC,4HAAW,GAAG,KAAK,4HAAW,GAAG,MAAM,GAAG,KAAK,EAAE,GAAG;gBAChE,IAAI,SAAS,GAAG;gBAChB,IAAI,IAAI;gBAER,IAAI,SAAS;gBACb,IAAI,GAAG,CAAC,GAAG,4HAAW,GAAG,KAAK,4HAAW,GAAG,MAAM,GAAG,KAAK,EAAE,GAAG;gBAC/D,IAAI,SAAS,GAAG;gBAChB,IAAI,IAAI;gBAER,IAAI,MAAM,CAAC,CAAC;YACd;YAEA,IAAI,KAAK,UAAU,EAAE;gBACnB,IAAI,SAAS,GAAG;gBAChB,IAAI,IAAI,GAAG,CAAC,KAAK,EAAE,4HAAW,GAAG,IAAI,oBAAoB,CAAC;gBAC1D,IAAI,SAAS,GAAG;gBAChB,IAAI,YAAY,GAAG;gBACnB,IAAI,QAAQ,CAAC,KAAK,GAAG;gBAErB,IAAI,SAAS,GAAG;gBAChB,IAAI,IAAI,GAAG,CAAC,KAAK,EAAE,4HAAW,GAAG,IAAI,oBAAoB,CAAC;gBAC1D,IAAI,QAAQ,CAAC,KAAK,GAAG;YACvB,OAAO,IAAI,KAAK,MAAM,EAAE;gBACtB,IAAI,SAAS,GAAG;gBAChB,IAAI,IAAI,GAAG,CAAC,KAAK,EAAE,4HAAW,CAAC,oBAAoB,CAAC;gBACpD,IAAI,SAAS,GAAG;gBAChB,IAAI,YAAY,GAAG;gBACnB,IAAI,QAAQ,CAAC,kIAAiB,CAAC,KAAK,MAAM,CAAC,EAAE,GAAG;YAClD;YAEA,IAAI,SAAS;YACb,IAAI,GAAG,CACL,CAAC,4HAAW,GAAG,MACf,CAAC,4HAAW,GAAG,MACf,4HAAW,GAAG,MACd,GACA,KAAK,EAAE,GAAG;YAEZ,IAAI,SAAS,GAAG;YAChB,IAAI,IAAI;YAER,IAAI,OAAO;QACb;2CAAG,EAAE;IAEL,MAAM,cAAc,IAAA,yIAAW;+CAAC,CAAC;YAC/B,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG;YAEjB,IAAI,IAAI;YACR,IAAI,SAAS,CAAC,GAAG;YACjB,IAAI,MAAM,CAAC;YAEX,MAAM,kBAAkB,IAAI,oBAAoB,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC;YAC9D,gBAAgB,YAAY,CAAC,GAAG;YAChC,gBAAgB,YAAY,CAAC,GAAG;YAEhC,IAAI,SAAS;YACb,IAAI,SAAS,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI;YAChC,IAAI,SAAS,GAAG;YAChB,IAAI,IAAI;YACR,IAAI,WAAW,GAAG;YAClB,IAAI,SAAS,GAAG;YAChB,IAAI,MAAM;YAEV,IAAI,OAAO;YAEX,IAAI,SAAS;YACb,IAAI,GAAG,CAAC,GAAG,GAAG,IAAI,GAAG,KAAK,EAAE,GAAG;YAC/B,MAAM,eAAe,IAAI,oBAAoB,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG;YAC7D,aAAa,YAAY,CAAC,GAAG;YAC7B,aAAa,YAAY,CAAC,GAAG;YAC7B,IAAI,SAAS,GAAG;YAChB,IAAI,IAAI;YACR,IAAI,WAAW,GAAG;YAClB,IAAI,SAAS,GAAG;YAChB,IAAI,MAAM;YAEV,IAAI,UAAU,WAAW,EAAE;gBACzB,SAAS,KAAK;oBAAE,GAAG,UAAU,WAAW;oBAAE;oBAAG;gBAAE,GAAG;YACpD;YAEA,IAAI,IAAI;YACR,IAAI,WAAW,GAAG;YAClB,IAAI,SAAS,GAAG;YAChB,IAAI,WAAW,CAAC;gBAAC;gBAAG;aAAE;YACtB,IAAI,SAAS;YACb,IAAI,MAAM,CAAC,GAAG;YACd,MAAM,YAAY;YAClB,IAAI,MAAM,CACR,IAAI,KAAK,GAAG,CAAC,gBAAgB,WAC7B,IAAI,KAAK,GAAG,CAAC,gBAAgB;YAE/B,IAAI,MAAM;YACV,IAAI,OAAO;QACb;8CAAG;QAAC;QAAiB;QAAc,UAAU,WAAW;QAAE;KAAS;IAEnE,MAAM,iBAAiB,IAAA,yIAAW;kDAAC,CAAC;YAClC,IAAI,CAAC,YAAY;YACjB,SAAS,KAAK;gBAAE,GAAG,WAAW,IAAI;gBAAE,GAAG,WAAW,CAAC;gBAAE,GAAG,WAAW,CAAC;YAAC;QACvE;iDAAG;QAAC;QAAY;KAAS;IAEzB,MAAM,OAAO,IAAA,yIAAW;wCAAC;YACvB,MAAM,SAAS,UAAU,OAAO;YAChC,IAAI,CAAC,QAAQ;YAEb,MAAM,MAAM,OAAO,UAAU,CAAC;YAC9B,IAAI,CAAC,KAAK;YAEV,IAAI,SAAS,CAAC,GAAG,GAAG,OAAO;YAE3B,SAAS;YAET,KAAK,MAAM,QAAQ,UAAU,KAAK,CAAE;gBAClC,SAAS,KAAK;YAChB;YAEA,eAAe;YAEf,YAAY;YAEZ,kBAAkB,OAAO,GAAG,sBAAsB;QACpD;uCAAG;QAAC;QAAO;QAAQ,UAAU,KAAK;QAAE;QAAU;QAAU;QAAgB;KAAY;IAEpF,IAAA,uIAAS;gCAAC;YACR;YACA;wCAAO;oBACL,IAAI,kBAAkB,OAAO,EAAE;wBAC7B,qBAAqB,kBAAkB,OAAO;oBAChD;gBACF;;QACF;+BAAG;QAAC;KAAK;IAET,MAAM,oBAAoB,IAAA,yIAAW;qDAAC,CAAC,SAAiB,SAAiB;YACvE,MAAM,SAAS,UAAU,OAAO;YAChC,IAAI,CAAC,QAAQ;YAEb,MAAM,OAAO,OAAO,qBAAqB;YACzC,MAAM,IAAI,CAAC,UAAU,KAAK,IAAI,IAAI,CAAC,QAAQ,KAAK,KAAK;YACrD,MAAM,IAAI,CAAC,UAAU,KAAK,GAAG,IAAI,CAAC,SAAS,KAAK,MAAM;YAEtD,IAAI,SAAS;gBACX,QAAQ,GAAG;YACb,OAAO;gBACL,MAAM,GAAG;YACX;QACF;oDAAG;QAAC;QAAO;QAAQ;QAAS;KAAM;IAElC,MAAM,cAAc,IAAA,yIAAW;+CAAC,CAAC;YAC/B,kBAAkB,EAAE,OAAO,EAAE,EAAE,OAAO,EAAE;QAC1C;8CAAG;QAAC;KAAkB;IAEtB,MAAM,kBAAkB,IAAA,yIAAW;mDAAC,CAAC;YACnC,kBAAkB,EAAE,OAAO,EAAE,EAAE,OAAO,EAAE;QAC1C;kDAAG;QAAC;KAAkB;IAEtB,MAAM,mBAAmB,IAAA,yIAAW;oDAAC,CAAC;YACpC,EAAE,cAAc;YAChB,MAAM,QAAQ,EAAE,OAAO,CAAC,EAAE;YAC1B,kBAAkB,MAAM,OAAO,EAAE,MAAM,OAAO,EAAE;QAClD;mDAAG;QAAC;KAAkB;IAEtB,MAAM,kBAAkB,IAAA,yIAAW;mDAAC,CAAC;YACnC,EAAE,cAAc;YAChB,MAAM,QAAQ,EAAE,OAAO,CAAC,EAAE;YAC1B,kBAAkB,MAAM,OAAO,EAAE,MAAM,OAAO,EAAE;QAClD;kDAAG;QAAC;KAAkB;IAEtB,MAAM,iBAAiB,IAAA,yIAAW;kDAAC,CAAC;YAClC,EAAE,cAAc;YAChB,IAAI,EAAE,cAAc,CAAC,MAAM,GAAG,GAAG;gBAC/B,MAAM,QAAQ,EAAE,cAAc,CAAC,EAAE;gBACjC,kBAAkB,MAAM,OAAO,EAAE,MAAM,OAAO,EAAE;YAClD;QACF;iDAAG;QAAC;KAAkB;IAEtB,qBACE,0JAAC;QACC,KAAK;QACL,OAAO;QACP,QAAQ;QACR,SAAS;QACT,aAAa;QACb,cAAc;QACd,aAAa;QACb,YAAY;QACZ,WAAU;QACV,eAAY;;;;;;AAGlB;GA1XgB;KAAA;AA4XhB,SAAS,aAAa,GAAW,EAAE,OAAe;IAChD,MAAM,MAAM,SAAS,IAAI,OAAO,CAAC,KAAK,KAAK;IAC3C,MAAM,MAAM,KAAK,KAAK,CAAC,OAAO;IAC9B,MAAM,IAAI,KAAK,GAAG,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI;IACtC,MAAM,IAAI,KAAK,GAAG,CAAC,KAAK,CAAC,AAAC,OAAO,IAAK,MAAM,IAAI;IAChD,MAAM,IAAI,KAAK,GAAG,CAAC,KAAK,CAAC,MAAM,QAAQ,IAAI;IAC3C,OAAO,CAAC,CAAC,EAAE,CAAC,YAAY,IAAI,UAAU,IAAI,QAAQ,CAAC,EAAE,QAAQ,CAAC,IAAI,KAAK,CAAC,IAAI;AAC9E;AAEA,SAAS,YAAY,GAAW,EAAE,OAAe;IAC/C,MAAM,MAAM,SAAS,IAAI,OAAO,CAAC,KAAK,KAAK;IAC3C,MAAM,MAAM,KAAK,KAAK,CAAC,OAAO;IAC9B,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI;IACpC,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,CAAC,AAAC,OAAO,IAAK,MAAM,IAAI;IAC9C,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,CAAC,MAAM,QAAQ,IAAI;IACzC,OAAO,CAAC,CAAC,EAAE,CAAC,YAAY,IAAI,UAAU,IAAI,QAAQ,CAAC,EAAE,QAAQ,CAAC,IAAI,KAAK,CAAC,IAAI;AAC9E"}},
    {"offset": {"line": 1320, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/GameHUD.tsx"],"sourcesContent":["import type { GameState } from '@shared/schema';\r\nimport { Clock, Zap, Circle, Heart, Plus, Loader2, Timer, Bomb, Sparkles, RotateCcw, Shield, Magnet, Crosshair, Ticket } from 'lucide-react';\r\nimport { getEconomyConfig, getBoostState } from '@/lib/gameEngine';\r\nimport { Button } from '@/components/ui/button';\r\nimport type { BoostType } from '@/lib/gameEngine';\r\n\r\nexport interface BoostInventoryItem {\r\n  boostType: BoostType;\r\n  quantity: number;\r\n}\r\n\r\ninterface GameHUDProps {\r\n  gameState: GameState;\r\n  elapsedTime: number;\r\n  ballsOnScreen: number;\r\n  ballsRemaining: number;\r\n  totalBalls: number;\r\n  totalSpawned: number;\r\n  currentLifeMax: number;\r\n  userBeads: number;\r\n  lifeCost: number;\r\n  maxExtraLives: number;\r\n  onBuyLife: () => void;\r\n  isBuyingLife: boolean;\r\n  boostInventory?: BoostInventoryItem[];\r\n  onUseBoost?: (boostType: BoostType) => void;\r\n  isUsingBoost?: boolean;\r\n  bonusLives?: number;\r\n  useCryptoTicket?: boolean;\r\n  isPaused?: boolean;\r\n  onTogglePause?: () => void;\r\n  onStepFrame?: () => void;\r\n}\r\n\r\nexport function GameHUD({ \r\n  gameState, \r\n  elapsedTime, \r\n  ballsOnScreen, \r\n  ballsRemaining, \r\n  totalBalls,\r\n  totalSpawned,\r\n  currentLifeMax,\r\n  userBeads,\r\n  lifeCost,\r\n  maxExtraLives,\r\n  onBuyLife,\r\n  isBuyingLife,\r\n  boostInventory = [],\r\n  onUseBoost,\r\n  isUsingBoost = false,\r\n  bonusLives = 0,\r\n  useCryptoTicket = false,\r\n  isPaused = false,\r\n  onTogglePause,\r\n  onStepFrame,\r\n}: GameHUDProps) {\r\n  const { score, combo, cryptoCollected, lives, extraLivesBought } = gameState;\r\n  const canBuyLife = userBeads >= lifeCost && extraLivesBought < maxExtraLives;\r\n  const boostState = getBoostState();\r\n  \r\n  const economy = getEconomyConfig();\r\n  const SATS_PER_BTC = 100_000_000;\r\n  const WEI_PER_ETH = 1_000_000_000_000_000_000; // 10^18\r\n  \r\n  const btcSats = Math.round(cryptoCollected.btc * economy.cryptoRewards.btcPerBall * SATS_PER_BTC);\r\n  const ethWei = Math.round(cryptoCollected.eth * economy.cryptoRewards.ethPerBall * WEI_PER_ETH);\r\n  const usdtAmount = cryptoCollected.usdt * economy.cryptoRewards.usdtPerBall;\r\n\r\n  const formatTime = (seconds: number) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return mins > 0 ? `${mins}:${secs.toString().padStart(2, '0')}` : `${secs}s`;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"absolute top-0 left-0 right-0 z-10 px-4 py-3\">\r\n        <div className=\"flex items-center justify-between gap-4 backdrop-blur-md bg-background/80 rounded-lg px-4 py-3 border border-border/50\">\r\n          <div className=\"flex flex-col gap-2\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"flex items-center gap-1.5 text-muted-foreground\">\r\n                <Clock className=\"w-4 h-4\" />\r\n                <span className=\"font-display font-bold text-lg tabular-nums\" data-testid=\"text-timer\">\r\n                  {formatTime(elapsedTime)}\r\n                </span>\r\n              </div>\r\n              {/* Crypto ticket indicator */}\r\n              {useCryptoTicket && (\r\n                <div className=\"flex items-center gap-1 px-2 py-0.5 rounded-full bg-green-500/20 border border-green-500/40\">\r\n                  <Ticket className=\"w-3 h-3 text-green-400\" />\r\n                  <span className=\"text-xs font-medium text-green-400\">КРИПТО</span>\r\n                </div>\r\n              )}\r\n              <div className=\"flex items-center gap-1\" data-testid=\"lives-display\">\r\n                {/* Стандартные 3 жизни */}\r\n                {[...Array(3)].map((_, i) => (\r\n                  <Heart\r\n                    key={`base-${i}`}\r\n                    className={`w-4 h-4 ${i < lives ? 'text-red-500 fill-red-500' : 'text-muted-foreground/30'}`}\r\n                  />\r\n                ))}\r\n                {/* Бонусные жизни из BEADS BOX - изумрудные сердца */}\r\n                {bonusLives > 0 && [...Array(bonusLives)].map((_, i) => (\r\n                  <Heart\r\n                    key={`bonus-${i}`}\r\n                    className=\"w-4 h-4 text-emerald-400 fill-emerald-400\"\r\n                  />\r\n                ))}\r\n                {extraLivesBought > 0 && (\r\n                  <span className=\"text-xs text-green-500 font-bold\">+{extraLivesBought}</span>\r\n                )}\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant={canBuyLife ? \"default\" : \"outline\"}\r\n                  onClick={onBuyLife}\r\n                  disabled={!canBuyLife || isBuyingLife}\r\n                  className={`h-6 px-2 ml-1 text-xs ${!canBuyLife ? 'opacity-50' : ''}`}\r\n                  data-testid=\"button-buy-life\"\r\n                >\r\n                  {isBuyingLife ? (\r\n                    <Loader2 className=\"w-3 h-3 animate-spin\" />\r\n                  ) : (\r\n                    <>\r\n                      <Plus className=\"w-3 h-3 mr-0.5\" />\r\n                      {lifeCost}\r\n                    </>\r\n                  )}\r\n                </Button>\r\n              </div>\r\n              {/* DEBUG CONTROLS */}\r\n              {process.env.NODE_ENV === 'development' && (\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Button size=\"sm\" variant=\"outline\" onClick={onTogglePause} className=\"h-6 px-2 text-xs\">\r\n                    {isPaused ? 'Resume' : 'Pause'}\r\n                  </Button>\r\n                  <Button size=\"sm\" variant=\"outline\" onClick={onStepFrame} disabled={!isPaused} className=\"h-6 px-2 text-xs\">\r\n                    Step\r\n                  </Button>\r\n                </div>\r\n              )}\r\n            </div>\r\n            {boostInventory.length > 0 && (\r\n              <div className=\"flex items-center gap-1\">\r\n                {boostInventory.map((item) => (\r\n                  <BoostButton\r\n                    key={item.boostType}\r\n                    boostType={item.boostType}\r\n                    quantity={item.quantity}\r\n                    onUse={() => onUseBoost?.(item.boostType)}\r\n                    disabled={isUsingBoost || item.quantity <= 0}\r\n                    isActive={\r\n                      (item.boostType === 'slowdown' && boostState.slowdownActive) ||\r\n                      (item.boostType === 'rainbow' && boostState.rainbowActive) ||\r\n                      (item.boostType === 'bomb' && boostState.pendingBomb) ||\r\n                      (item.boostType === 'rewind' && boostState.pendingRewind) ||\r\n                      (item.boostType === 'shield' && boostState.shieldActive) ||\r\n                      (item.boostType === 'magnet' && boostState.magnetActive) ||\r\n                      (item.boostType === 'laser' && boostState.pendingLaser)\r\n                    }\r\n                  />\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"flex flex-col items-center\">\r\n            <span className=\"text-xs text-muted-foreground uppercase tracking-wide\">Beads</span>\r\n            <span className=\"font-display font-bold text-2xl text-primary tabular-nums\" data-testid=\"text-score\">\r\n              {score.toLocaleString()}\r\n            </span>\r\n          </div>\r\n\r\n          <div className=\"flex flex-col items-end gap-1 text-muted-foreground\">\r\n            <div className=\"flex items-center gap-2\">\r\n              {combo > 1 && (\r\n                <div className=\"flex items-center gap-1 text-amber-400 animate-pulse\">\r\n                  <Zap className=\"w-4 h-4\" />\r\n                  <span className=\"font-display font-bold text-lg\" data-testid=\"text-combo\">\r\n                    x{combo}\r\n                  </span>\r\n                </div>\r\n              )}\r\n              <div className=\"flex items-center gap-1.5\">\r\n                <Circle className=\"w-4 h-4\" />\r\n                <span className=\"font-semibold text-sm tabular-nums\" data-testid=\"text-balls\">\r\n                  {ballsOnScreen}\r\n                </span>\r\n              </div>\r\n            </div>\r\n            <div className=\"text-xs tabular-nums\" data-testid=\"spawn-counter\">\r\n              Появилось: {totalSpawned} / {currentLifeMax}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n      </div>\r\n\r\n    </>\r\n  );\r\n}\r\n\r\ninterface CryptoRewardCounterProps {\r\n  type: 'btc' | 'eth' | 'usdt';\r\n  value: number;\r\n  unit: string;\r\n}\r\n\r\nfunction CryptoRewardCounter({ type, value, unit }: CryptoRewardCounterProps) {\r\n  const config = {\r\n    btc: { symbol: '₿', color: 'text-[#f7931a]', bgColor: 'bg-[#f7931a]/10' },\r\n    eth: { symbol: 'Ξ', color: 'text-[#627eea]', bgColor: 'bg-[#627eea]/10' },\r\n    usdt: { symbol: '₮', color: 'text-[#26a17b]', bgColor: 'bg-[#26a17b]/10' },\r\n  };\r\n\r\n  const { symbol, color, bgColor } = config[type];\r\n  \r\n  const displayValue = type === 'usdt' \r\n    ? (value > 0 ? `$${value.toFixed(4)}` : '$0')\r\n    : type === 'eth' ? `${value.toFixed(2)} ${unit}` : `${value} ${unit}`;\r\n\r\n  return (\r\n    <div \r\n      className={`flex items-center gap-1.5 px-2 py-1 rounded-md ${bgColor}`}\r\n      data-testid={`crypto-reward-${type}`}\r\n    >\r\n      <span className={`font-bold text-sm ${color}`}>{symbol}</span>\r\n      <span className=\"font-semibold text-xs tabular-nums text-foreground\">\r\n        {displayValue}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface BoostButtonProps {\r\n  boostType: BoostType;\r\n  quantity: number;\r\n  onUse: () => void;\r\n  disabled: boolean;\r\n  isActive: boolean;\r\n}\r\n\r\nconst BOOST_CONFIG: Record<BoostType, { icon: typeof Timer; color: string; bgColor: string; label: string }> = {\r\n  slowdown: { icon: Timer, color: 'text-blue-400', bgColor: 'bg-blue-500/20', label: 'Замедление' },\r\n  bomb: { icon: Bomb, color: 'text-red-400', bgColor: 'bg-red-500/20', label: 'Бомба' },\r\n  rainbow: { icon: Sparkles, color: 'text-purple-400', bgColor: 'bg-purple-500/20', label: 'Радуга' },\r\n  rewind: { icon: RotateCcw, color: 'text-green-400', bgColor: 'bg-green-500/20', label: 'Откат' },\r\n  shield: { icon: Shield, color: 'text-cyan-400', bgColor: 'bg-cyan-500/20', label: 'Щит' },\r\n  magnet: { icon: Magnet, color: 'text-orange-400', bgColor: 'bg-orange-500/20', label: 'Магнит' },\r\n  laser: { icon: Crosshair, color: 'text-yellow-400', bgColor: 'bg-yellow-500/20', label: 'Лазер' },\r\n};\r\n\r\nfunction BoostButton({ boostType, quantity, onUse, disabled, isActive }: BoostButtonProps) {\r\n  const config = BOOST_CONFIG[boostType];\r\n  const Icon = config.icon;\r\n\r\n  return (\r\n    <Button\r\n      size=\"sm\"\r\n      variant=\"ghost\"\r\n      onClick={onUse}\r\n      disabled={disabled}\r\n      className={`relative h-10 px-3 ${config.bgColor} ${isActive ? 'ring-2 ring-primary animate-pulse' : ''} ${disabled ? 'opacity-40' : 'hover-elevate'}`}\r\n      data-testid={`button-boost-${boostType}`}\r\n    >\r\n      <Icon className={`w-5 h-5 ${config.color}`} />\r\n      {quantity > 0 && (\r\n        <span className=\"absolute -top-1 -right-1 bg-primary text-primary-foreground text-xs font-bold rounded-full w-4 h-4 flex items-center justify-center\">\r\n          {quantity}\r\n        </span>\r\n      )}\r\n    </Button>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1815, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/NextBallPreview.tsx"],"sourcesContent":["import type { Ball } from '@shared/schema';\r\nimport { BALL_COLOR_MAP, CRYPTO_COLOR_MAP, CRYPTO_SYMBOL_MAP } from '@/lib/gameEngine';\r\n\r\ninterface NextBallPreviewProps {\r\n  ball: Ball | null;\r\n}\r\n\r\nexport function NextBallPreview({ ball }: NextBallPreviewProps) {\r\n  if (!ball) return null;\r\n\r\n  // For crypto balls, use crypto color as background; for regular balls use normal color\r\n  const baseColor = ball.crypto \r\n    ? CRYPTO_COLOR_MAP[ball.crypto] \r\n    : (ball.isUsdtFund ? '#FFD700' : BALL_COLOR_MAP[ball.color]);\r\n\r\n  const isSpecial = ball.isUsdtFund || ball.crypto;\r\n  const glowColor = ball.isUsdtFund ? '#FFD700' : (ball.crypto ? CRYPTO_COLOR_MAP[ball.crypto] : undefined);\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center gap-1\">\r\n      <span className=\"text-xs text-muted-foreground uppercase tracking-wide\">Next</span>\r\n      <div \r\n        className=\"relative w-10 h-10 rounded-full flex items-center justify-center border-2\"\r\n        style={{ \r\n          backgroundColor: baseColor,\r\n          borderColor: darkenColor(baseColor, 20),\r\n          boxShadow: isSpecial ? `0 0 12px ${glowColor}, 0 0 4px ${glowColor}` : undefined,\r\n        }}\r\n        data-testid=\"next-ball-preview\"\r\n      >\r\n        {ball.isUsdtFund ? (\r\n          <span className=\"font-bold text-lg\" style={{ color: '#FFD700', textShadow: '0 0 4px #FFD700' }}>$</span>\r\n        ) : ball.crypto ? (\r\n          <span className=\"text-white font-bold text-sm\" style={{ textShadow: `0 0 4px ${CRYPTO_COLOR_MAP[ball.crypto]}` }}>\r\n            {CRYPTO_SYMBOL_MAP[ball.crypto]}\r\n          </span>\r\n        ) : null}\r\n        <div \r\n          className=\"absolute top-1 left-1.5 w-2 h-2 rounded-full bg-white/40\"\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction darkenColor(hex: string, percent: number): string {\r\n  const num = parseInt(hex.replace('#', ''), 16);\r\n  const amt = Math.round(2.55 * percent);\r\n  const R = Math.max(0, (num >> 16) - amt);\r\n  const G = Math.max(0, ((num >> 8) & 0x00ff) - amt);\r\n  const B = Math.max(0, (num & 0x0000ff) - amt);\r\n  return `#${(0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1)}`;\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;;;AAMO,SAAS,gBAAgB,EAAE,IAAI,EAAwB;IAC5D,IAAI,CAAC,MAAM,OAAO;IAElB,uFAAuF;IACvF,MAAM,YAAY,KAAK,MAAM,GACzB,iIAAgB,CAAC,KAAK,MAAM,CAAC,GAC5B,KAAK,UAAU,GAAG,YAAY,+HAAc,CAAC,KAAK,KAAK,CAAC;IAE7D,MAAM,YAAY,KAAK,UAAU,IAAI,KAAK,MAAM;IAChD,MAAM,YAAY,KAAK,UAAU,GAAG,YAAa,KAAK,MAAM,GAAG,iIAAgB,CAAC,KAAK,MAAM,CAAC,GAAG;IAE/F,qBACE,0JAAC;QAAI,WAAU;;0BACb,0JAAC;gBAAK,WAAU;0BAAwD;;;;;;0BACxE,0JAAC;gBACC,WAAU;gBACV,OAAO;oBACL,iBAAiB;oBACjB,aAAa,YAAY,WAAW;oBACpC,WAAW,YAAY,CAAC,SAAS,EAAE,UAAU,UAAU,EAAE,WAAW,GAAG;gBACzE;gBACA,eAAY;;oBAEX,KAAK,UAAU,iBACd,0JAAC;wBAAK,WAAU;wBAAoB,OAAO;4BAAE,OAAO;4BAAW,YAAY;wBAAkB;kCAAG;;;;;+BAC9F,KAAK,MAAM,iBACb,0JAAC;wBAAK,WAAU;wBAA+B,OAAO;4BAAE,YAAY,CAAC,QAAQ,EAAE,iIAAgB,CAAC,KAAK,MAAM,CAAC,EAAE;wBAAC;kCAC5G,kIAAiB,CAAC,KAAK,MAAM,CAAC;;;;;+BAE/B;kCACJ,0JAAC;wBACC,WAAU;;;;;;;;;;;;;;;;;;AAKpB;KApCgB;AAsChB,SAAS,YAAY,GAAW,EAAE,OAAe;IAC/C,MAAM,MAAM,SAAS,IAAI,OAAO,CAAC,KAAK,KAAK;IAC3C,MAAM,MAAM,KAAK,KAAK,CAAC,OAAO;IAC9B,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI;IACpC,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,CAAC,AAAC,OAAO,IAAK,MAAM,IAAI;IAC9C,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,CAAC,MAAM,QAAQ,IAAI;IACzC,OAAO,CAAC,CAAC,EAAE,CAAC,YAAY,IAAI,UAAU,IAAI,QAAQ,CAAC,EAAE,QAAQ,CAAC,IAAI,KAAK,CAAC,IAAI;AAC9E"}},
    {"offset": {"line": 1909, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/GameScreen.tsx"],"sourcesContent":["import { useRef, useState, useEffect, useCallback } from 'react';\r\nimport type { GameState, LivesConfig, Boost, UserBoostInventory } from '@shared/schema';\r\nimport { GameCanvas } from './GameCanvas';\r\nimport { GameHUD, type BoostInventoryItem } from './GameHUD';\r\nimport { NextBallPreview } from './NextBallPreview';\r\nimport { GameOverScreen } from './GameOverScreen';\r\nimport { useGameState } from '@/hooks/useGameState';\r\nimport { \r\n  setLevelCompleted,\r\n  activateSlowdown,\r\n  activateRainbow,\r\n  activateBomb,\r\n  activateRewind,\r\n  activateShield,\r\n  activateMagnet,\r\n  activateLaser,\r\n  type BoostType\r\n} from '@/lib/gameEngine';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Play } from 'lucide-react';\r\nimport { apiRequest, queryClient } from '@/lib/queryClient';\r\nimport { useUser } from '@/contexts/UserContext';\r\nimport { useQuery, useMutation } from '@tanstack/react-query';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport type { LevelConfig } from '@/lib/levelConfig';\r\nimport { \r\n  playSlowdownSound, \r\n  playBombSound, \r\n  playRainbowSound, \r\n  playRewindSound, \r\n  playShieldSound, \r\n  playMagnetSound, \r\n  playLaserSound \r\n} from '@/lib/sounds';\r\n\r\ninterface GameScreenProps {\r\n  level: LevelConfig;\r\n  isLevelCompleted: boolean;\r\n  onGameEnd: (state: GameState) => void;\r\n  onViewLeaderboard: () => void;\r\n  onMainMenu: () => void;\r\n  useCryptoTicket?: boolean;\r\n}\r\n\r\nexport function GameScreen({ level, isLevelCompleted, onGameEnd, onViewLeaderboard, onMainMenu, useCryptoTicket = false }: GameScreenProps) {\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  // Track if crypto ticket was used for the FIRST game only\r\n  const [cryptoTicketActive, setCryptoTicketActive] = useState(useCryptoTicket);\r\n  const isFirstGameRef = useRef(true);\r\n  \r\n  // Set level completion state for crypto ball spawning (only on mount/changes)\r\n  useEffect(() => {\r\n    // When using crypto ticket, treat level as not completed so crypto balls spawn\r\n    const effectiveCompleted = cryptoTicketActive ? false : isLevelCompleted;\r\n    setLevelCompleted(effectiveCompleted);\r\n    \r\n    // Cleanup: restore original state when unmounting\r\n    return () => {\r\n      setLevelCompleted(isLevelCompleted);\r\n    };\r\n  }, [cryptoTicketActive, isLevelCompleted]);\r\n  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });\r\n  const sessionIdRef = useRef<string | null>(null);\r\n  const [isBuyingLife, setIsBuyingLife] = useState(false);\r\n  const { user, refreshUser } = useUser();\r\n  const { toast } = useToast();\r\n\r\n  const { data: livesConfig } = useQuery<LivesConfig>({\r\n    queryKey: [\"/api/lives-config\"],\r\n  });\r\n\r\n  const { data: userBoostsData } = useQuery<Array<UserBoostInventory & { boost: Boost }>>({\r\n    queryKey: [\"/api/user/boosts\"],\r\n    enabled: !!user,\r\n    refetchOnWindowFocus: false,\r\n  });\r\n\r\n  const boostInventory: BoostInventoryItem[] = (userBoostsData || []).map(item => ({\r\n    boostType: item.boost.type as BoostType,\r\n    quantity: item.quantity,\r\n  }));\r\n\r\n  const useBoostMutation = useMutation({\r\n    mutationFn: async (boostId: string) => {\r\n      const res = await apiRequest('POST', '/api/boosts/use', { boostId });\r\n      if (!res.ok) {\r\n        const data = await res.json();\r\n        throw new Error(data.error || 'Failed to use boost');\r\n      }\r\n      return res.json();\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"/api/user/boosts\"] });\r\n    },\r\n  });\r\n\r\n  const handleUseBoost = useCallback((boostType: BoostType) => {\r\n    const inventoryItem = userBoostsData?.find(item => item.boost.type === boostType);\r\n    if (!inventoryItem || inventoryItem.quantity <= 0) {\r\n      toast({\r\n        title: \"Буст недоступен\",\r\n        description: \"У вас нет этого буста\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    useBoostMutation.mutate(inventoryItem.boostId, {\r\n      onSuccess: () => {\r\n        switch (boostType) {\r\n          case 'slowdown':\r\n            activateSlowdown(10000, 0.5);\r\n            playSlowdownSound();\r\n            toast({ title: \"Замедление активировано!\", description: \"Шары замедлены на 10 секунд\" });\r\n            break;\r\n          case 'rainbow':\r\n            activateRainbow();\r\n            playRainbowSound();\r\n            toast({ title: \"Радуга активирована!\", description: \"Следующий шар совместим со всеми цветами\" });\r\n            break;\r\n          case 'bomb':\r\n            activateBomb();\r\n            playBombSound();\r\n            toast({ title: \"Бомба активирована!\", description: \"Следующий выстрел уничтожит область\" });\r\n            break;\r\n          case 'rewind':\r\n            activateRewind();\r\n            applyRewind();\r\n            playRewindSound();\r\n            toast({ title: \"Откат активирован!\", description: \"Шары откатились назад\" });\r\n            break;\r\n          case 'shield':\r\n            activateShield();\r\n            playShieldSound();\r\n            toast({ title: \"Щит активирован!\", description: \"Защита от одного попадания в конец\" });\r\n            break;\r\n          case 'magnet':\r\n            activateMagnet(3);\r\n            playMagnetSound();\r\n            toast({ title: \"Магнит активирован!\", description: \"Притянет ближайшие шары\" });\r\n            break;\r\n          case 'laser':\r\n            activateLaser(3);\r\n            playLaserSound();\r\n            toast({ title: \"Лазер активирован!\", description: \"Пробьёт несколько шаров\" });\r\n            break;\r\n        }\r\n      },\r\n      onError: (error: Error) => {\r\n        toast({\r\n          title: \"Ошибка\",\r\n          description: error.message,\r\n          variant: \"destructive\",\r\n        });\r\n      },\r\n    });\r\n  }, [userBoostsData, useBoostMutation, toast]);\r\n\r\n  const startSession = useCallback(async () => {\r\n    try {\r\n      const res = await apiRequest('POST', '/api/game/start', {});\r\n      const data = await res.json();\r\n      sessionIdRef.current = data.sessionId;\r\n    } catch (error) {\r\n      console.error('Failed to start session:', error);\r\n    }\r\n  }, []);\r\n\r\n  const endSession = useCallback(async () => {\r\n    if (sessionIdRef.current) {\r\n      try {\r\n        await apiRequest('POST', '/api/game/end', { sessionId: sessionIdRef.current });\r\n        sessionIdRef.current = null;\r\n      } catch (error) {\r\n        console.error('Failed to end session:', error);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  const handleGameEnd = useCallback((state: GameState) => {\r\n    endSession();\r\n    onGameEnd(state);\r\n  }, [endSession, onGameEnd]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (sessionIdRef.current) {\r\n        navigator.sendBeacon('/api/game/end', JSON.stringify({ sessionId: sessionIdRef.current }));\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const updateDimensions = () => {\r\n      if (containerRef.current) {\r\n        const rect = containerRef.current.getBoundingClientRect();\r\n        setDimensions({\r\n          width: rect.width,\r\n          height: rect.height - 160,\r\n        });\r\n      }\r\n    };\r\n\r\n    updateDimensions();\r\n    window.addEventListener('resize', updateDimensions);\r\n    return () => window.removeEventListener('resize', updateDimensions);\r\n  }, []);\r\n\r\n  const {\r\n    gameState,\r\n    path,\r\n    projectile,\r\n    shooterAngle,\r\n    shooterPosition,\r\n    elapsedTime,\r\n    ballsOnScreen,\r\n    ballsRemaining,\r\n    totalBalls,\r\n    totalSpawned,\r\n    currentLifeMax,\r\n    isPaused,\r\n    startGame: originalStartGame,\r\n    shoot,\r\n    updateAim,\r\n    addExtraLife,\r\n    resumeGame,\r\n    applyRewind,\r\n    togglePause,\r\n    stepFrame,\r\n  } = useGameState({\r\n    canvasWidth: dimensions.width,\r\n    canvasHeight: dimensions.height,\r\n    onGameEnd: handleGameEnd,\r\n    level,\r\n    bonusLives: user?.bonusLives || 0,\r\n    onUseBonusLife: async () => {\r\n      try {\r\n        await apiRequest('POST', '/api/use-bonus-life', {});\r\n        await refreshUser();\r\n      } catch (error) {\r\n        console.error('Failed to use bonus life:', error);\r\n      }\r\n    },\r\n  });\r\n\r\n  const startGame = useCallback(() => {\r\n    // Crypto ticket is already consumed in Home.tsx before entering this screen\r\n    startSession();\r\n    originalStartGame();\r\n  }, [startSession, originalStartGame]);\r\n\r\n  const hasStartedRef = useRef(false);\r\n  const startGameRef = useRef(startGame);\r\n  startGameRef.current = startGame;\r\n  \r\n  useEffect(() => {\r\n    if (dimensions.width > 0 && dimensions.height > 0 && !hasStartedRef.current) {\r\n      hasStartedRef.current = true;\r\n      startGameRef.current();\r\n    }\r\n  }, [dimensions.width, dimensions.height]);\r\n\r\n  const handlePlayAgain = useCallback(() => {\r\n    // Crypto ticket only applies to the first game\r\n    if (isFirstGameRef.current) {\r\n      isFirstGameRef.current = false;\r\n    }\r\n    // Disable crypto ticket for replay\r\n    setCryptoTicketActive(false);\r\n    setLevelCompleted(isLevelCompleted);\r\n    startGame();\r\n  }, [startGame, isLevelCompleted]);\r\n\r\n  const handleBuyLife = useCallback(async () => {\r\n    if (!livesConfig || isBuyingLife) return;\r\n    if (!user || user.totalPoints < livesConfig.extraLifeCost) {\r\n      toast({\r\n        title: \"Недостаточно Beads\",\r\n        description: `Нужно ${livesConfig.extraLifeCost} Beads для покупки жизни`,\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    if (gameState.extraLivesBought >= livesConfig.maxExtraLives) {\r\n      toast({\r\n        title: \"Лимит достигнут\",\r\n        description: `Максимум ${livesConfig.maxExtraLives} дополнительных жизней за игру`,\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    setIsBuyingLife(true);\r\n    try {\r\n      const res = await apiRequest('POST', '/api/buy-life', {});\r\n      if (!res.ok) {\r\n        const data = await res.json();\r\n        throw new Error(data.error || 'Failed to buy life');\r\n      }\r\n      addExtraLife(livesConfig.extraLifeSeconds);\r\n      await refreshUser();\r\n      toast({\r\n        title: \"+1 Жизнь!\",\r\n        description: \"Шарики сброшены в начало\",\r\n      });\r\n    } catch (error: any) {\r\n      toast({\r\n        title: \"Ошибка покупки\",\r\n        description: error.message,\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsBuyingLife(false);\r\n    }\r\n  }, [livesConfig, isBuyingLife, user, gameState.extraLivesBought, addExtraLife, refreshUser, toast]);\r\n\r\n  const handleContinue = useCallback(async () => {\r\n    if (!livesConfig || isBuyingLife) return;\r\n    if (!user || user.totalPoints < livesConfig.extraLifeCost) {\r\n      toast({\r\n        title: \"Недостаточно Beads\",\r\n        description: `Нужно ${livesConfig.extraLifeCost} Beads для продолжения`,\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    if (gameState.extraLivesBought >= livesConfig.maxExtraLives) {\r\n      toast({\r\n        title: \"Лимит достигнут\",\r\n        description: `Максимум ${livesConfig.maxExtraLives} дополнительных жизней за игру`,\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    setIsBuyingLife(true);\r\n    try {\r\n      const res = await apiRequest('POST', '/api/buy-life', {});\r\n      if (!res.ok) {\r\n        const data = await res.json();\r\n        throw new Error(data.error || 'Failed to buy life');\r\n      }\r\n      resumeGame();\r\n      await refreshUser();\r\n      toast({\r\n        title: \"+1 Жизнь!\",\r\n        description: \"Игра продолжается, шарики сброшены в начало\",\r\n      });\r\n    } catch (error: any) {\r\n      toast({\r\n        title: \"Ошибка покупки\",\r\n        description: error.message,\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsBuyingLife(false);\r\n    }\r\n  }, [livesConfig, isBuyingLife, user, gameState.extraLivesBought, resumeGame, refreshUser, toast]);\r\n\r\n  return (\r\n    <div \r\n      ref={containerRef}\r\n      className=\"fixed inset-0 bg-background overflow-hidden flex flex-col\"\r\n      data-testid=\"game-screen\"\r\n    >\r\n      {gameState.isPlaying && (\r\n        <GameHUD \r\n          gameState={gameState} \r\n          elapsedTime={elapsedTime}\r\n          ballsOnScreen={ballsOnScreen}\r\n          ballsRemaining={ballsRemaining}\r\n          totalBalls={totalBalls}\r\n          totalSpawned={totalSpawned}\r\n          currentLifeMax={currentLifeMax}\r\n          userBeads={user?.totalPoints || 0}\r\n          lifeCost={livesConfig?.extraLifeCost || 50}\r\n          maxExtraLives={livesConfig?.maxExtraLives || 5}\r\n          onBuyLife={handleBuyLife}\r\n          isBuyingLife={isBuyingLife}\r\n          boostInventory={boostInventory}\r\n          onUseBoost={handleUseBoost}\r\n          isUsingBoost={useBoostMutation.isPending}\r\n          bonusLives={user?.bonusLives || 0}\r\n          useCryptoTicket={cryptoTicketActive}\r\n          isPaused={isPaused}\r\n          onTogglePause={togglePause}\r\n          onStepFrame={stepFrame}\r\n        />\r\n      )}\r\n\r\n      <div className=\"flex-1 relative mt-24\">\r\n        {dimensions.width > 0 && dimensions.height > 0 && (\r\n          <GameCanvas\r\n            gameState={gameState}\r\n            path={path}\r\n            projectile={projectile}\r\n            shooterAngle={shooterAngle}\r\n            shooterPosition={shooterPosition}\r\n            onShoot={shoot}\r\n            onAim={updateAim}\r\n            width={dimensions.width}\r\n            height={dimensions.height}\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"h-24 bg-gradient-to-t from-background to-transparent px-4 py-3 flex items-center justify-between relative\">\r\n        <div className=\"w-16\" />\r\n        \r\n        <div className=\"absolute left-1/2 -translate-x-1/2 top-2\">\r\n          <NextBallPreview ball={gameState.nextBall} />\r\n        </div>\r\n        \r\n        <div className=\"w-16 flex justify-end\">\r\n          {!gameState.isPlaying && !gameState.isGameOver && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              onClick={startGame}\r\n              data-testid=\"button-start-game\"\r\n            >\r\n              <Play className=\"w-5 h-5\" />\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {gameState.isGameOver && (\r\n        <GameOverScreen\r\n          gameState={gameState}\r\n          onPlayAgain={handlePlayAgain}\r\n          onViewLeaderboard={onViewLeaderboard}\r\n          onMainMenu={onMainMenu}\r\n          onContinue={handleContinue}\r\n          user={user}\r\n          lifeCost={livesConfig?.extraLifeCost || 50}\r\n          maxExtraLives={livesConfig?.maxExtraLives || 5}\r\n          isBuyingLife={isBuyingLife}\r\n          levelName={level.nameRu}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2483, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/Leaderboard.tsx"],"sourcesContent":["import type { LeaderboardEntry } from '@shared/schema';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\nimport { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { ArrowLeft, Trophy, Medal, Crown, Star, Calendar, Clock, Users, User } from 'lucide-react';\r\nimport { motion } from 'framer-motion';\r\n\r\ntype LeaderboardFilter = 'all' | 'week' | 'today' | 'friends';\r\n\r\ninterface LeaderboardProps {\r\n  entries: LeaderboardEntry[];\r\n  currentUserId?: string;\r\n  isLoading?: boolean;\r\n  isFetching?: boolean;\r\n  onBack: () => void;\r\n  filter?: LeaderboardFilter;\r\n  onFilterChange?: (filter: LeaderboardFilter) => void;\r\n}\r\n\r\nexport function Leaderboard({ entries, currentUserId, isLoading, isFetching, onBack, filter = 'all', onFilterChange }: LeaderboardProps) {\r\n  const top3 = entries.slice(0, 3);\r\n  const rest = entries.slice(3);\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5\">\r\n      <div className=\"sticky top-0 z-10 bg-background/95 backdrop-blur-sm border-b border-border\">\r\n        <div className=\"flex items-center gap-4 px-4 py-3\">\r\n          <Button \r\n            variant=\"ghost\" \r\n            size=\"icon\" \r\n            onClick={onBack}\r\n            data-testid=\"button-back\"\r\n          >\r\n            <ArrowLeft className=\"w-5 h-5\" />\r\n          </Button>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Trophy className=\"w-5 h-5 text-primary\" />\r\n            <h1 className=\"font-display text-xl font-bold\">Рейтинг</h1>\r\n          </div>\r\n        </div>\r\n        \r\n        {onFilterChange && (\r\n          <div className=\"px-4 pb-3\">\r\n            <Tabs value={filter} onValueChange={(v) => onFilterChange(v as LeaderboardFilter)}>\r\n              <TabsList className=\"w-full grid grid-cols-4\">\r\n                <TabsTrigger value=\"all\" className=\"text-xs\" data-testid=\"tab-filter-all\">\r\n                  <Trophy className=\"w-3 h-3 mr-1\" />\r\n                  Всё\r\n                </TabsTrigger>\r\n                <TabsTrigger value=\"week\" className=\"text-xs\" data-testid=\"tab-filter-week\">\r\n                  <Calendar className=\"w-3 h-3 mr-1\" />\r\n                  Неделя\r\n                </TabsTrigger>\r\n                <TabsTrigger value=\"today\" className=\"text-xs\" data-testid=\"tab-filter-today\">\r\n                  <Clock className=\"w-3 h-3 mr-1\" />\r\n                  Сегодня\r\n                </TabsTrigger>\r\n                <TabsTrigger value=\"friends\" className=\"text-xs\" data-testid=\"tab-filter-friends\">\r\n                  <Users className=\"w-3 h-3 mr-1\" />\r\n                  Друзья\r\n                </TabsTrigger>\r\n              </TabsList>\r\n            </Tabs>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"p-4 max-w-md mx-auto\">\r\n        {isLoading || isFetching ? (\r\n          <LeaderboardSkeleton />\r\n        ) : entries.length === 0 ? (\r\n          <EmptyLeaderboard filter={filter} />\r\n        ) : (\r\n          <>\r\n            <TopThreePodium entries={top3} currentUserId={currentUserId} />\r\n\r\n            <div className=\"mt-6 space-y-2\">\r\n              {rest.map((entry, index) => (\r\n                <LeaderboardRow\r\n                  key={entry.userId}\r\n                  entry={entry}\r\n                  isCurrentUser={entry.userId === currentUserId}\r\n                  delay={index * 0.05}\r\n                />\r\n              ))}\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface TopThreePodiumProps {\r\n  entries: LeaderboardEntry[];\r\n  currentUserId?: string;\r\n}\r\n\r\nfunction TopThreePodium({ entries, currentUserId }: TopThreePodiumProps) {\r\n  const [first, second, third] = entries;\r\n\r\n  return (\r\n    <div className=\"flex items-end justify-center gap-2 pt-8 pb-4\">\r\n      {second && (\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.2 }}\r\n          className=\"flex-1\"\r\n        >\r\n          <PodiumCard entry={second} rank={2} isCurrentUser={second.userId === currentUserId} />\r\n        </motion.div>\r\n      )}\r\n\r\n      {first && (\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.1 }}\r\n          className=\"flex-1\"\r\n        >\r\n          <PodiumCard entry={first} rank={1} isCurrentUser={first.userId === currentUserId} />\r\n        </motion.div>\r\n      )}\r\n\r\n      {third && (\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.3 }}\r\n          className=\"flex-1\"\r\n        >\r\n          <PodiumCard entry={third} rank={3} isCurrentUser={third.userId === currentUserId} />\r\n        </motion.div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface PodiumCardProps {\r\n  entry: LeaderboardEntry;\r\n  rank: 1 | 2 | 3;\r\n  isCurrentUser?: boolean;\r\n}\r\n\r\nfunction PodiumCard({ entry, rank, isCurrentUser }: PodiumCardProps) {\r\n  const heightClass = rank === 1 ? 'h-28' : rank === 2 ? 'h-20' : 'h-16';\r\n  const bgClass = rank === 1 \r\n    ? 'bg-gradient-to-t from-amber-500/20 to-amber-400/10 border-amber-500/30' \r\n    : rank === 2 \r\n    ? 'bg-gradient-to-t from-slate-400/20 to-slate-300/10 border-slate-400/30'\r\n    : 'bg-gradient-to-t from-orange-700/20 to-orange-600/10 border-orange-700/30';\r\n  \r\n  const iconColor = rank === 1 ? 'text-amber-400' : rank === 2 ? 'text-slate-300' : 'text-orange-600';\r\n  const RankIcon = rank === 1 ? Crown : Medal;\r\n  \r\n  const displayName = entry.characterName || entry.username;\r\n  const avatarImage = entry.characterImageUrl || entry.photoUrl;\r\n\r\n  return (\r\n    <Card \r\n      className={`relative p-3 text-center ${isCurrentUser ? 'ring-2 ring-primary' : ''}`}\r\n      data-testid={`podium-rank-${rank}`}\r\n    >\r\n      <div className=\"absolute -top-3 left-1/2 -translate-x-1/2\">\r\n        <div className={`w-6 h-6 rounded-full flex items-center justify-center ${bgClass} border`}>\r\n          <RankIcon className={`w-3.5 h-3.5 ${iconColor}`} />\r\n        </div>\r\n      </div>\r\n\r\n      <Avatar className=\"w-12 h-12 mx-auto mt-2 border-2 border-border\">\r\n        <AvatarImage src={avatarImage || undefined} alt=\"\" />\r\n        <AvatarFallback className=\"bg-muted\">\r\n          <User className=\"w-6 h-6 text-muted-foreground\" />\r\n        </AvatarFallback>\r\n      </Avatar>\r\n\r\n      <h3 className=\"font-semibold text-sm mt-2 truncate\">{displayName}</h3>\r\n      \r\n      <div className={`mt-2 rounded-lg border ${bgClass} ${heightClass} flex items-end justify-center pb-2`}>\r\n        <div className=\"flex flex-col items-center\">\r\n          <Star className={`w-4 h-4 ${iconColor} mb-1`} />\r\n          <span className=\"font-display font-bold text-sm tabular-nums\">\r\n            {entry.totalPoints.toLocaleString()}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  );\r\n}\r\n\r\ninterface LeaderboardRowProps {\r\n  entry: LeaderboardEntry;\r\n  isCurrentUser?: boolean;\r\n  delay?: number;\r\n}\r\n\r\nfunction LeaderboardRow({ entry, isCurrentUser, delay = 0 }: LeaderboardRowProps) {\r\n  const displayName = entry.characterName || entry.username;\r\n  const avatarImage = entry.characterImageUrl || entry.photoUrl;\r\n  \r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, x: -10 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      transition={{ delay }}\r\n    >\r\n      <Card \r\n        className={`flex items-center gap-3 p-3 ${isCurrentUser ? 'ring-2 ring-primary bg-primary/5' : ''}`}\r\n        data-testid={`leaderboard-row-${entry.rank}`}\r\n      >\r\n        <div className=\"w-8 text-center font-display font-bold text-muted-foreground\">\r\n          #{entry.rank}\r\n        </div>\r\n\r\n        <Avatar className=\"w-10 h-10 border border-border\">\r\n          <AvatarImage src={avatarImage || undefined} alt=\"\" />\r\n          <AvatarFallback className=\"bg-muted\">\r\n            <User className=\"w-5 h-5 text-muted-foreground\" />\r\n          </AvatarFallback>\r\n        </Avatar>\r\n\r\n        <div className=\"flex-1 min-w-0\">\r\n          <h3 className=\"font-semibold text-sm truncate\">{displayName}</h3>\r\n          <p className=\"text-xs text-muted-foreground\">\r\n            {entry.gamesPlayed} игр\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"text-right\">\r\n          <div className=\"font-display font-bold text-primary tabular-nums\">\r\n            {entry.totalPoints.toLocaleString()}\r\n          </div>\r\n          <div className=\"text-xs text-muted-foreground\">Beads</div>\r\n        </div>\r\n      </Card>\r\n    </motion.div>\r\n  );\r\n}\r\n\r\nfunction LeaderboardSkeleton() {\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex items-end justify-center gap-2 pt-8 pb-4\">\r\n        {[2, 1, 3].map((rank) => (\r\n          <div key={rank} className=\"flex-1\">\r\n            <Skeleton className={`h-40 rounded-lg ${rank === 1 ? 'h-48' : ''}`} />\r\n          </div>\r\n        ))}\r\n      </div>\r\n      {[...Array(5)].map((_, i) => (\r\n        <Skeleton key={i} className=\"h-16 rounded-lg\" />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction EmptyLeaderboard({ filter }: { filter?: LeaderboardFilter }) {\r\n  const messages: Record<LeaderboardFilter, { title: string; subtitle: string }> = {\r\n    all: { title: 'Пока нет игроков', subtitle: 'Стань первым и займи топ!' },\r\n    week: { title: 'Нет игр за неделю', subtitle: 'Сыграй первым на этой неделе!' },\r\n    today: { title: 'Нет игр сегодня', subtitle: 'Сыграй первым сегодня!' },\r\n    friends: { title: 'Нет друзей в рейтинге', subtitle: 'Пригласи друзей по реферальной ссылке!' },\r\n  };\r\n  \r\n  const message = messages[filter || 'all'];\r\n  \r\n  return (\r\n    <div className=\"text-center py-16\">\r\n      <Trophy className=\"w-16 h-16 mx-auto text-muted-foreground/50 mb-4\" />\r\n      <h3 className=\"font-display text-xl font-semibold mb-2\">{message.title}</h3>\r\n      <p className=\"text-muted-foreground\">\r\n        {message.subtitle}\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;AAcO,SAAS,YAAY,EAAE,OAAO,EAAE,aAAa,EAAE,SAAS,EAAE,UAAU,EAAE,MAAM,EAAE,SAAS,KAAK,EAAE,cAAc,EAAoB;IACrI,MAAM,OAAO,QAAQ,KAAK,CAAC,GAAG;IAC9B,MAAM,OAAO,QAAQ,KAAK,CAAC;IAE3B,qBACE,0JAAC;QAAI,WAAU;;0BACb,0JAAC;gBAAI,WAAU;;kCACb,0JAAC;wBAAI,WAAU;;0CACb,0JAAC,iIAAM;gCACL,SAAQ;gCACR,MAAK;gCACL,SAAS;gCACT,eAAY;0CAEZ,cAAA,0JAAC,yNAAS;oCAAC,WAAU;;;;;;;;;;;0CAEvB,0JAAC;gCAAI,WAAU;;kDACb,0JAAC,4MAAM;wCAAC,WAAU;;;;;;kDAClB,0JAAC;wCAAG,WAAU;kDAAiC;;;;;;;;;;;;;;;;;;oBAIlD,gCACC,0JAAC;wBAAI,WAAU;kCACb,cAAA,0JAAC,6HAAI;4BAAC,OAAO;4BAAQ,eAAe,CAAC,IAAM,eAAe;sCACxD,cAAA,0JAAC,iIAAQ;gCAAC,WAAU;;kDAClB,0JAAC,oIAAW;wCAAC,OAAM;wCAAM,WAAU;wCAAU,eAAY;;0DACvD,0JAAC,4MAAM;gDAAC,WAAU;;;;;;4CAAiB;;;;;;;kDAGrC,0JAAC,oIAAW;wCAAC,OAAM;wCAAO,WAAU;wCAAU,eAAY;;0DACxD,0JAAC,kNAAQ;gDAAC,WAAU;;;;;;4CAAiB;;;;;;;kDAGvC,0JAAC,oIAAW;wCAAC,OAAM;wCAAQ,WAAU;wCAAU,eAAY;;0DACzD,0JAAC,yMAAK;gDAAC,WAAU;;;;;;4CAAiB;;;;;;;kDAGpC,0JAAC,oIAAW;wCAAC,OAAM;wCAAU,WAAU;wCAAU,eAAY;;0DAC3D,0JAAC,yMAAK;gDAAC,WAAU;;;;;;4CAAiB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAS9C,0JAAC;gBAAI,WAAU;0BACZ,aAAa,2BACZ,0JAAC;;;;2BACC,QAAQ,MAAM,KAAK,kBACrB,0JAAC;oBAAiB,QAAQ;;;;;yCAE1B;;sCACE,0JAAC;4BAAe,SAAS;4BAAM,eAAe;;;;;;sCAE9C,0JAAC;4BAAI,WAAU;sCACZ,KAAK,GAAG,CAAC,CAAC,OAAO,sBAChB,0JAAC;oCAEC,OAAO;oCACP,eAAe,MAAM,MAAM,KAAK;oCAChC,OAAO,QAAQ;mCAHV,MAAM,MAAM;;;;;;;;;;;;;;;;;;;;;;;AAYnC;KAxEgB;AA+EhB,SAAS,eAAe,EAAE,OAAO,EAAE,aAAa,EAAuB;IACrE,MAAM,CAAC,OAAO,QAAQ,MAAM,GAAG;IAE/B,qBACE,0JAAC;QAAI,WAAU;;YACZ,wBACC,0JAAC,gMAAM,CAAC,GAAG;gBACT,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAG;gBAC7B,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAE;gBAC5B,YAAY;oBAAE,OAAO;gBAAI;gBACzB,WAAU;0BAEV,cAAA,0JAAC;oBAAW,OAAO;oBAAQ,MAAM;oBAAG,eAAe,OAAO,MAAM,KAAK;;;;;;;;;;;YAIxE,uBACC,0JAAC,gMAAM,CAAC,GAAG;gBACT,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAG;gBAC7B,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAE;gBAC5B,YAAY;oBAAE,OAAO;gBAAI;gBACzB,WAAU;0BAEV,cAAA,0JAAC;oBAAW,OAAO;oBAAO,MAAM;oBAAG,eAAe,MAAM,MAAM,KAAK;;;;;;;;;;;YAItE,uBACC,0JAAC,gMAAM,CAAC,GAAG;gBACT,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAG;gBAC7B,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAE;gBAC5B,YAAY;oBAAE,OAAO;gBAAI;gBACzB,WAAU;0BAEV,cAAA,0JAAC;oBAAW,OAAO;oBAAO,MAAM;oBAAG,eAAe,MAAM,MAAM,KAAK;;;;;;;;;;;;;;;;;AAK7E;MAvCS;AA+CT,SAAS,WAAW,EAAE,KAAK,EAAE,IAAI,EAAE,aAAa,EAAmB;IACjE,MAAM,cAAc,SAAS,IAAI,SAAS,SAAS,IAAI,SAAS;IAChE,MAAM,UAAU,SAAS,IACrB,2EACA,SAAS,IACT,2EACA;IAEJ,MAAM,YAAY,SAAS,IAAI,mBAAmB,SAAS,IAAI,mBAAmB;IAClF,MAAM,WAAW,SAAS,IAAI,yMAAK,GAAG,yMAAK;IAE3C,MAAM,cAAc,MAAM,aAAa,IAAI,MAAM,QAAQ;IACzD,MAAM,cAAc,MAAM,iBAAiB,IAAI,MAAM,QAAQ;IAE7D,qBACE,0JAAC,6HAAI;QACH,WAAW,CAAC,yBAAyB,EAAE,gBAAgB,wBAAwB,IAAI;QACnF,eAAa,CAAC,YAAY,EAAE,MAAM;;0BAElC,0JAAC;gBAAI,WAAU;0BACb,cAAA,0JAAC;oBAAI,WAAW,CAAC,sDAAsD,EAAE,QAAQ,OAAO,CAAC;8BACvF,cAAA,0JAAC;wBAAS,WAAW,CAAC,YAAY,EAAE,WAAW;;;;;;;;;;;;;;;;0BAInD,0JAAC,iIAAM;gBAAC,WAAU;;kCAChB,0JAAC,sIAAW;wBAAC,KAAK,eAAe;wBAAW,KAAI;;;;;;kCAChD,0JAAC,yIAAc;wBAAC,WAAU;kCACxB,cAAA,0JAAC,sMAAI;4BAAC,WAAU;;;;;;;;;;;;;;;;;0BAIpB,0JAAC;gBAAG,WAAU;0BAAuC;;;;;;0BAErD,0JAAC;gBAAI,WAAW,CAAC,uBAAuB,EAAE,QAAQ,CAAC,EAAE,YAAY,mCAAmC,CAAC;0BACnG,cAAA,0JAAC;oBAAI,WAAU;;sCACb,0JAAC,sMAAI;4BAAC,WAAW,CAAC,QAAQ,EAAE,UAAU,KAAK,CAAC;;;;;;sCAC5C,0JAAC;4BAAK,WAAU;sCACb,MAAM,WAAW,CAAC,cAAc;;;;;;;;;;;;;;;;;;;;;;;AAM7C;MA5CS;AAoDT,SAAS,eAAe,EAAE,KAAK,EAAE,aAAa,EAAE,QAAQ,CAAC,EAAuB;IAC9E,MAAM,cAAc,MAAM,aAAa,IAAI,MAAM,QAAQ;IACzD,MAAM,cAAc,MAAM,iBAAiB,IAAI,MAAM,QAAQ;IAE7D,qBACE,0JAAC,gMAAM,CAAC,GAAG;QACT,SAAS;YAAE,SAAS;YAAG,GAAG,CAAC;QAAG;QAC9B,SAAS;YAAE,SAAS;YAAG,GAAG;QAAE;QAC5B,YAAY;YAAE;QAAM;kBAEpB,cAAA,0JAAC,6HAAI;YACH,WAAW,CAAC,4BAA4B,EAAE,gBAAgB,qCAAqC,IAAI;YACnG,eAAa,CAAC,gBAAgB,EAAE,MAAM,IAAI,EAAE;;8BAE5C,0JAAC;oBAAI,WAAU;;wBAA+D;wBAC1E,MAAM,IAAI;;;;;;;8BAGd,0JAAC,iIAAM;oBAAC,WAAU;;sCAChB,0JAAC,sIAAW;4BAAC,KAAK,eAAe;4BAAW,KAAI;;;;;;sCAChD,0JAAC,yIAAc;4BAAC,WAAU;sCACxB,cAAA,0JAAC,sMAAI;gCAAC,WAAU;;;;;;;;;;;;;;;;;8BAIpB,0JAAC;oBAAI,WAAU;;sCACb,0JAAC;4BAAG,WAAU;sCAAkC;;;;;;sCAChD,0JAAC;4BAAE,WAAU;;gCACV,MAAM,WAAW;gCAAC;;;;;;;;;;;;;8BAIvB,0JAAC;oBAAI,WAAU;;sCACb,0JAAC;4BAAI,WAAU;sCACZ,MAAM,WAAW,CAAC,cAAc;;;;;;sCAEnC,0JAAC;4BAAI,WAAU;sCAAgC;;;;;;;;;;;;;;;;;;;;;;;AAKzD;MAzCS;AA2CT,SAAS;IACP,qBACE,0JAAC;QAAI,WAAU;;0BACb,0JAAC;gBAAI,WAAU;0BACZ;oBAAC;oBAAG;oBAAG;iBAAE,CAAC,GAAG,CAAC,CAAC,qBACd,0JAAC;wBAAe,WAAU;kCACxB,cAAA,0JAAC,qIAAQ;4BAAC,WAAW,CAAC,gBAAgB,EAAE,SAAS,IAAI,SAAS,IAAI;;;;;;uBAD1D;;;;;;;;;;YAKb;mBAAI,MAAM;aAAG,CAAC,GAAG,CAAC,CAAC,GAAG,kBACrB,0JAAC,qIAAQ;oBAAS,WAAU;mBAAb;;;;;;;;;;;AAIvB;MAfS;AAiBT,SAAS,iBAAiB,EAAE,MAAM,EAAkC;IAClE,MAAM,WAA2E;QAC/E,KAAK;YAAE,OAAO;YAAoB,UAAU;QAA4B;QACxE,MAAM;YAAE,OAAO;YAAqB,UAAU;QAAgC;QAC9E,OAAO;YAAE,OAAO;YAAmB,UAAU;QAAyB;QACtE,SAAS;YAAE,OAAO;YAAyB,UAAU;QAAyC;IAChG;IAEA,MAAM,UAAU,QAAQ,CAAC,UAAU,MAAM;IAEzC,qBACE,0JAAC;QAAI,WAAU;;0BACb,0JAAC,4MAAM;gBAAC,WAAU;;;;;;0BAClB,0JAAC;gBAAG,WAAU;0BAA2C,QAAQ,KAAK;;;;;;0BACtE,0JAAC;gBAAE,WAAU;0BACV,QAAQ,QAAQ;;;;;;;;;;;;AAIzB;MAnBS"}},
    {"offset": {"line": 3174, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/LevelSelect.tsx"],"sourcesContent":["import { useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Lock, ArrowLeft, Star, Zap, Target, Coins, Ticket } from 'lucide-react';\r\nimport { SiBitcoin } from 'react-icons/si';\r\nimport { \r\n  LEVELS, \r\n  type LevelConfig, \r\n  getDifficultyColor, \r\n  getDifficultyBgColor, \r\n  getDifficultyLabel,\r\n  isLevelUnlocked \r\n} from '@/lib/levelConfig';\r\n\r\ninterface LevelSelectProps {\r\n  completedLevels: number[];\r\n  onSelectLevel: (level: LevelConfig, useCryptoTicket?: boolean) => void;\r\n  onBack: () => void;\r\n  cryptoTickets?: number;\r\n}\r\n\r\nfunction PathPreview({ pathType, size = 60 }: { pathType: string; size?: number }) {\r\n  const center = size / 2;\r\n  const scale = size / 100;\r\n  \r\n  const getPathD = () => {\r\n    switch (pathType) {\r\n      case 'spiral': {\r\n        let d = '';\r\n        const turns = 2.5;\r\n        const outerR = 40 * scale;\r\n        const innerR = 8 * scale;\r\n        for (let i = 0; i <= 100; i++) {\r\n          const t = i / 100;\r\n          const angle = t * Math.PI * 2 * turns;\r\n          const r = outerR - (outerR - innerR) * t;\r\n          const x = center + r * Math.cos(angle - Math.PI / 2);\r\n          const y = center + r * Math.sin(angle - Math.PI / 2);\r\n          d += i === 0 ? `M ${x} ${y}` : ` L ${x} ${y}`;\r\n        }\r\n        return d;\r\n      }\r\n      case 'zigzag': {\r\n        const points = [];\r\n        const freq = 4;\r\n        const amp = 25 * scale;\r\n        for (let i = 0; i <= 100; i++) {\r\n          const t = i / 100;\r\n          const y = 5 * scale + t * 90 * scale;\r\n          const x = center + Math.sin(t * freq * Math.PI) * amp;\r\n          points.push(`${x} ${y}`);\r\n        }\r\n        return `M ${points.join(' L ')}`;\r\n      }\r\n      case 'wave': {\r\n        const points = [];\r\n        const freq = 2;\r\n        const amp = 20 * scale;\r\n        for (let i = 0; i <= 100; i++) {\r\n          const t = i / 100;\r\n          const y = 5 * scale + t * 90 * scale;\r\n          const x = center + Math.sin(t * freq * Math.PI * 2) * amp;\r\n          points.push(`${x} ${y}`);\r\n        }\r\n        return `M ${points.join(' L ')}`;\r\n      }\r\n      case 'sShape': {\r\n        const points = [];\r\n        const amp = 25 * scale;\r\n        for (let i = 0; i <= 100; i++) {\r\n          const t = i / 100;\r\n          const y = 5 * scale + t * 90 * scale;\r\n          const x = center + Math.sin(t * Math.PI * 2) * amp;\r\n          points.push(`${x} ${y}`);\r\n        }\r\n        return `M ${points.join(' L ')}`;\r\n      }\r\n      case 'heart': {\r\n        let d = '';\r\n        for (let i = 0; i <= 100; i++) {\r\n          const t = i / 100;\r\n          const angle = t * Math.PI * 2 - Math.PI / 2;\r\n          const hx = 16 * Math.pow(Math.sin(angle), 3);\r\n          const hy = -(13 * Math.cos(angle) - 5 * Math.cos(2 * angle) - 2 * Math.cos(3 * angle) - Math.cos(4 * angle));\r\n          const x = center + hx * 2 * scale;\r\n          const y = center + hy * 2 * scale;\r\n          d += i === 0 ? `M ${x} ${y}` : ` L ${x} ${y}`;\r\n        }\r\n        return d;\r\n      }\r\n      case 'infinity': {\r\n        let d = '';\r\n        for (let i = 0; i <= 100; i++) {\r\n          const t = i / 100;\r\n          const angle = t * Math.PI * 2;\r\n          const x = center + 35 * scale * Math.sin(angle);\r\n          const y = center + 15 * scale * Math.sin(angle * 2);\r\n          d += i === 0 ? `M ${x} ${y}` : ` L ${x} ${y}`;\r\n        }\r\n        return d;\r\n      }\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>\r\n      <defs>\r\n        <linearGradient id={`pathGrad-${pathType}`} x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n          <stop offset=\"0%\" stopColor=\"#00ff88\" />\r\n          <stop offset=\"50%\" stopColor=\"#00d4ff\" />\r\n          <stop offset=\"100%\" stopColor=\"#8b5cf6\" />\r\n        </linearGradient>\r\n      </defs>\r\n      <motion.path\r\n        d={getPathD()}\r\n        fill=\"none\"\r\n        stroke={`url(#pathGrad-${pathType})`}\r\n        strokeWidth={2.5}\r\n        strokeLinecap=\"round\"\r\n        initial={{ pathLength: 0 }}\r\n        animate={{ pathLength: 1 }}\r\n        transition={{ duration: 1.5, ease: \"easeOut\" }}\r\n      />\r\n    </svg>\r\n  );\r\n}\r\n\r\nfunction LevelCard({ \r\n  level, \r\n  isUnlocked, \r\n  isCompleted,\r\n  onSelect \r\n}: { \r\n  level: LevelConfig; \r\n  isUnlocked: boolean;\r\n  isCompleted: boolean;\r\n  onSelect: () => void;\r\n}) {\r\n  const difficultyColor = getDifficultyColor(level.difficulty);\r\n  const difficultyBg = getDifficultyBgColor(level.difficulty);\r\n  \r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, scale: 0.9 }}\r\n      animate={{ opacity: 1, scale: 1 }}\r\n      transition={{ delay: level.id * 0.05 }}\r\n      whileHover={isUnlocked ? { scale: 1.03 } : undefined}\r\n      whileTap={isUnlocked ? { scale: 0.97 } : undefined}\r\n    >\r\n      <Card\r\n        className={`relative overflow-hidden p-3 transition-all cursor-pointer ${\r\n          isUnlocked \r\n            ? 'border-primary/30 hover:border-primary/50' \r\n            : 'border-muted/20 opacity-60'\r\n        }`}\r\n        style={{\r\n          background: isUnlocked \r\n            ? 'linear-gradient(135deg, hsl(230 35% 12%) 0%, hsl(230 35% 8%) 100%)'\r\n            : 'linear-gradient(135deg, hsl(230 25% 10%) 0%, hsl(230 25% 7%) 100%)',\r\n          boxShadow: isUnlocked \r\n            ? '0 0 20px hsl(155 100% 50% / 0.1)' \r\n            : 'none',\r\n        }}\r\n        onClick={isUnlocked ? onSelect : undefined}\r\n        data-testid={`card-level-${level.id}`}\r\n      >\r\n        {!isUnlocked && (\r\n          <div className=\"absolute inset-0 flex items-center justify-center bg-black/40 z-10\">\r\n            <div className=\"flex flex-col items-center gap-1\">\r\n              <Lock className=\"w-6 h-6 text-muted-foreground\" />\r\n              <span className=\"text-xs text-muted-foreground\">\r\n                Пройди ур. {level.unlockCondition}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {isCompleted && (\r\n          <div \r\n            className=\"absolute top-2 right-2 w-6 h-6 rounded-full flex items-center justify-center z-20\"\r\n            style={{ backgroundColor: '#00ff88', boxShadow: '0 0 10px #00ff88' }}\r\n          >\r\n            <Star className=\"w-4 h-4 text-black\" fill=\"black\" />\r\n          </div>\r\n        )}\r\n        \r\n        {/* Crypto indicator for uncompleted levels */}\r\n        {isUnlocked && !isCompleted && (\r\n          <div \r\n            className=\"absolute top-2 right-2 flex items-center gap-1 px-1.5 py-0.5 rounded-full z-20\"\r\n            style={{ backgroundColor: 'rgba(247, 147, 26, 0.2)', border: '1px solid rgba(247, 147, 26, 0.4)' }}\r\n            title=\"Криптошарики доступны\"\r\n          >\r\n            <SiBitcoin className=\"w-3 h-3\" style={{ color: '#f7931a' }} />\r\n            <span className=\"text-[10px] font-medium\" style={{ color: '#f7931a' }}>КРИПТО</span>\r\n          </div>\r\n        )}\r\n        \r\n        <div className=\"flex items-start gap-3\">\r\n          <div \r\n            className=\"flex-shrink-0 rounded-lg p-1\"\r\n            style={{ backgroundColor: 'hsl(230 30% 15%)' }}\r\n          >\r\n            <PathPreview pathType={level.path.type} size={56} />\r\n          </div>\r\n          \r\n          <div className=\"flex-1 min-w-0\">\r\n            <div className=\"flex items-center gap-2 mb-1\">\r\n              <span \r\n                className=\"font-bold text-sm tabular-nums\"\r\n                style={{ color: '#00d4ff' }}\r\n              >\r\n                #{level.id}\r\n              </span>\r\n              <Badge \r\n                variant=\"secondary\" \r\n                className={`text-xs px-1.5 py-0 ${difficultyColor} ${difficultyBg} border-0`}\r\n              >\r\n                {getDifficultyLabel(level.difficulty)}\r\n              </Badge>\r\n            </div>\r\n            \r\n            <h3 className=\"font-semibold text-sm truncate mb-1\" data-testid={`text-level-name-${level.id}`}>\r\n              {level.nameRu}\r\n            </h3>\r\n            \r\n            <p className=\"text-xs text-muted-foreground line-clamp-1\">\r\n              {level.descriptionRu}\r\n            </p>\r\n            \r\n            <div className=\"flex items-center gap-3 mt-2 text-xs text-muted-foreground\">\r\n              <div className=\"flex items-center gap-1\">\r\n                <Target className=\"w-3 h-3\" style={{ color: '#f7931a' }} />\r\n                <span>{level.targetBalls}</span>\r\n              </div>\r\n              <div className=\"flex items-center gap-1\">\r\n                <Zap className=\"w-3 h-3\" style={{ color: '#8b5cf6' }} />\r\n                <span>{level.colors} цветов</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n    </motion.div>\r\n  );\r\n}\r\n\r\nexport function LevelSelect({ completedLevels, onSelectLevel, onBack, cryptoTickets = 0 }: LevelSelectProps) {\r\n  const [useCryptoTicket, setUseCryptoTicket] = useState(false);\r\n  \r\n  const handleSelectLevel = (level: LevelConfig) => {\r\n    onSelectLevel(level, useCryptoTicket && cryptoTickets > 0);\r\n  };\r\n  \r\n  return (\r\n    <div \r\n      className=\"min-h-screen flex flex-col p-4 pb-24\"\r\n      style={{ background: 'linear-gradient(180deg, hsl(230 35% 7%) 0%, hsl(230 35% 10%) 100%)' }}\r\n    >\r\n      <motion.div\r\n        initial={{ opacity: 0, y: -20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        className=\"flex items-center gap-3 mb-6\"\r\n      >\r\n        <Button\r\n          variant=\"ghost\"\r\n          size=\"icon\"\r\n          onClick={onBack}\r\n          className=\"flex-shrink-0\"\r\n          data-testid=\"button-back\"\r\n        >\r\n          <ArrowLeft className=\"w-5 h-5\" />\r\n        </Button>\r\n        <div>\r\n          <h1 \r\n            className=\"font-display text-2xl font-bold\"\r\n            style={{ \r\n              background: 'linear-gradient(135deg, #00ff88 0%, #00d4ff 50%, #8b5cf6 100%)',\r\n              WebkitBackgroundClip: 'text',\r\n              WebkitTextFillColor: 'transparent',\r\n            }}\r\n            data-testid=\"text-level-select-title\"\r\n          >\r\n            Выбор уровня\r\n          </h1>\r\n          <p className=\"text-sm text-muted-foreground\">\r\n            Пройдено: {completedLevels.length} / {LEVELS.length}\r\n          </p>\r\n        </div>\r\n      </motion.div>\r\n      \r\n      {/* Crypto hint */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: -10 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ delay: 0.15 }}\r\n        className=\"flex items-center gap-2 mb-4 px-3 py-2 rounded-lg\"\r\n        style={{ backgroundColor: 'rgba(247, 147, 26, 0.1)', border: '1px solid rgba(247, 147, 26, 0.2)' }}\r\n      >\r\n        <SiBitcoin className=\"w-4 h-4 flex-shrink-0\" style={{ color: '#f7931a' }} />\r\n        <p className=\"text-xs\" style={{ color: '#f7931a' }}>\r\n          Криптошарики появляются только на новых уровнях! Проходи дальше для крипто-наград.\r\n        </p>\r\n      </motion.div>\r\n      \r\n      {/* Crypto ticket toggle */}\r\n      {cryptoTickets > 0 && (\r\n        <motion.div\r\n          initial={{ opacity: 0, y: -10 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.12 }}\r\n          className={`mb-4 p-3 rounded-xl border cursor-pointer transition-all ${\r\n            useCryptoTicket \r\n              ? 'bg-gradient-to-r from-green-500/30 to-emerald-500/30 border-green-500/50 shadow-lg shadow-green-500/20' \r\n              : 'bg-gradient-to-r from-green-500/10 to-emerald-500/10 border-green-500/20'\r\n          }`}\r\n          onClick={() => setUseCryptoTicket(!useCryptoTicket)}\r\n          data-testid=\"toggle-crypto-ticket\"\r\n        >\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Ticket className={`w-5 h-5 ${useCryptoTicket ? 'text-green-300' : 'text-green-400'}`} />\r\n              <div>\r\n                <span className={`font-semibold ${useCryptoTicket ? 'text-green-300' : 'text-green-400'}`}>\r\n                  Крипто-билет ({cryptoTickets})\r\n                </span>\r\n                <p className=\"text-xs text-green-300/70\">\r\n                  {useCryptoTicket \r\n                    ? 'Криптошарики на любом уровне!' \r\n                    : 'Нажми чтобы активировать'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className={`w-12 h-6 rounded-full p-1 transition-colors ${\r\n              useCryptoTicket ? 'bg-green-500' : 'bg-slate-600'\r\n            }`}>\r\n              <motion.div \r\n                className=\"w-4 h-4 rounded-full bg-white\"\r\n                animate={{ x: useCryptoTicket ? 24 : 0 }}\r\n                transition={{ type: 'spring', stiffness: 500, damping: 30 }}\r\n              />\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n      )}\r\n\r\n      <motion.div\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        transition={{ delay: 0.1 }}\r\n        className=\"flex gap-2 mb-4 overflow-x-auto pb-2\"\r\n      >\r\n        {(['easy', 'medium', 'hard'] as const).map(diff => {\r\n          const count = LEVELS.filter(l => l.difficulty === diff).length;\r\n          const completed = LEVELS.filter(\r\n            l => l.difficulty === diff && completedLevels.includes(l.id)\r\n          ).length;\r\n          return (\r\n            <Badge\r\n              key={diff}\r\n              variant=\"secondary\"\r\n              className={`${getDifficultyColor(diff)} ${getDifficultyBgColor(diff)} border-0 whitespace-nowrap`}\r\n            >\r\n              {getDifficultyLabel(diff)}: {completed}/{count}\r\n            </Badge>\r\n          );\r\n        })}\r\n      </motion.div>\r\n\r\n      <div className=\"flex-1 overflow-y-auto\">\r\n        <div className=\"grid gap-3\">\r\n          {LEVELS.map(level => (\r\n            <LevelCard\r\n              key={level.id}\r\n              level={level}\r\n              isUnlocked={isLevelUnlocked(level.id, completedLevels)}\r\n              isCompleted={completedLevels.includes(level.id)}\r\n              onSelect={() => handleSelectLevel(level)}\r\n            />\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3953, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/AccessoryShop.tsx"],"sourcesContent":["import { useState } from 'react';\r\nimport { useQuery, useMutation } from '@tanstack/react-query';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { ArrowLeft, Coins, ShoppingBag, Check, Lock, Sparkles } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\nimport { apiRequest, queryClient } from '@/lib/queryClient';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useUser } from '@/contexts/UserContext';\r\nimport type { Accessory, AccessoryCategory, UserAccessory, CharacterWithAccessories } from '@shared/schema';\r\n\r\ninterface AccessoryShopProps {\r\n  onBack: () => void;\r\n}\r\n\r\nexport function AccessoryShop({ onBack }: AccessoryShopProps) {\r\n  const { user, refreshUser } = useUser();\r\n  const { toast } = useToast();\r\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\r\n\r\n  const { data: categories = [], isLoading: categoriesLoading } = useQuery<AccessoryCategory[]>({\r\n    queryKey: ['/api/accessories/categories'],\r\n  });\r\n\r\n  const { data: accessories = [], isLoading: accessoriesLoading } = useQuery<Accessory[]>({\r\n    queryKey: ['/api/accessories'],\r\n  });\r\n\r\n  const { data: ownedAccessories = [], isLoading: ownedLoading } = useQuery<UserAccessory[]>({\r\n    queryKey: ['/api/user/accessories'],\r\n  });\r\n\r\n  const { data: characterData } = useQuery<CharacterWithAccessories>({\r\n    queryKey: ['/api/character'],\r\n  });\r\n\r\n  const purchaseMutation = useMutation({\r\n    mutationFn: async (accessoryId: string) => {\r\n      const response = await apiRequest('POST', '/api/accessories/purchase', { accessoryId });\r\n      return response.json();\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['/api/user/accessories'] });\r\n      queryClient.invalidateQueries({ queryKey: ['/api/accessories'] });\r\n      refreshUser();\r\n      toast({\r\n        title: 'Покупка успешна!',\r\n        description: 'Аксессуар добавлен в вашу коллекцию',\r\n      });\r\n    },\r\n    onError: (error: any) => {\r\n      toast({\r\n        title: 'Ошибка покупки',\r\n        description: error.message || 'Не удалось купить аксессуар',\r\n        variant: 'destructive',\r\n      });\r\n    },\r\n  });\r\n\r\n  const ownedIds = new Set(ownedAccessories.map(ua => ua.accessoryId));\r\n  const userGender = characterData?.character?.gender;\r\n\r\n  const filteredAccessories = accessories.filter(acc => {\r\n    if (!acc.isActive) return false;\r\n    if (selectedCategory && acc.categoryId !== selectedCategory) return false;\r\n    if (userGender && acc.gender !== 'both' && acc.gender !== userGender) return false;\r\n    return true;\r\n  });\r\n\r\n  const sortedCategories = [...categories].sort((a, b) => a.sortOrder - b.sortOrder);\r\n\r\n  const isLoading = categoriesLoading || accessoriesLoading || ownedLoading;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-b from-background to-muted flex flex-col\">\r\n      <header className=\"p-4 flex items-center justify-between border-b bg-background/80 backdrop-blur-sm sticky top-0 z-10\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <Button variant=\"ghost\" size=\"icon\" onClick={onBack} data-testid=\"button-back\">\r\n            <ArrowLeft className=\"w-5 h-5\" />\r\n          </Button>\r\n          <div className=\"flex items-center gap-2\">\r\n            <ShoppingBag className=\"w-5 h-5 text-primary\" />\r\n            <h1 className=\"text-lg font-bold\">Магазин</h1>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center gap-2 bg-amber-100 dark:bg-amber-900/30 px-3 py-1.5 rounded-full\">\r\n          <Coins className=\"w-4 h-4 text-amber-600\" />\r\n          <span className=\"font-medium text-amber-700 dark:text-amber-400\" data-testid=\"text-beads-balance\">\r\n            {user?.totalPoints ?? 0}\r\n          </span>\r\n        </div>\r\n      </header>\r\n\r\n      <div className=\"p-4 overflow-x-auto\">\r\n        <div className=\"flex gap-2 pb-2\">\r\n          <Button\r\n            variant={selectedCategory === null ? 'default' : 'outline'}\r\n            size=\"sm\"\r\n            onClick={() => setSelectedCategory(null)}\r\n            data-testid=\"button-category-all\"\r\n          >\r\n            Все\r\n          </Button>\r\n          {sortedCategories.map((cat) => (\r\n            <Button\r\n              key={cat.id}\r\n              variant={selectedCategory === cat.id ? 'default' : 'outline'}\r\n              size=\"sm\"\r\n              onClick={() => setSelectedCategory(cat.id)}\r\n              className=\"flex-shrink-0\"\r\n              data-testid={`button-category-${cat.id}`}\r\n            >\r\n              {cat.nameRu}\r\n            </Button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      <ScrollArea className=\"flex-1 px-4 pb-4\">\r\n        {isLoading ? (\r\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n            {[...Array(6)].map((_, i) => (\r\n              <Card key={i}>\r\n                <CardContent className=\"p-3\">\r\n                  <Skeleton className=\"aspect-square rounded-lg mb-3\" />\r\n                  <Skeleton className=\"h-4 w-3/4 mb-2\" />\r\n                  <Skeleton className=\"h-8 w-full\" />\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n        ) : filteredAccessories.length === 0 ? (\r\n          <div className=\"flex flex-col items-center justify-center py-12 text-center\">\r\n            <ShoppingBag className=\"w-12 h-12 text-muted-foreground mb-4\" />\r\n            <p className=\"text-muted-foreground\">Нет доступных аксессуаров</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n            <AnimatePresence mode=\"popLayout\">\r\n              {filteredAccessories.map((acc) => {\r\n                const isOwned = ownedIds.has(acc.id);\r\n                const isSoldOut = acc.maxQuantity !== null && acc.soldCount >= acc.maxQuantity;\r\n                const canAfford = (user?.totalPoints ?? 0) >= acc.price;\r\n\r\n                return (\r\n                  <motion.div\r\n                    key={acc.id}\r\n                    layout\r\n                    initial={{ opacity: 0, scale: 0.9 }}\r\n                    animate={{ opacity: 1, scale: 1 }}\r\n                    exit={{ opacity: 0, scale: 0.9 }}\r\n                  >\r\n                    <Card className=\"overflow-hidden\" data-testid={`accessory-card-${acc.id}`}>\r\n                      <CardContent className=\"p-3 space-y-3\">\r\n                        <div className=\"relative aspect-square bg-muted rounded-lg overflow-hidden\">\r\n                          <img\r\n                            src={acc.imageUrl}\r\n                            alt={acc.nameRu}\r\n                            className=\"w-full h-full object-contain\"\r\n                          />\r\n                          {isOwned && (\r\n                            <div className=\"absolute inset-0 bg-green-500/20 flex items-center justify-center\">\r\n                              <div className=\"bg-green-500 rounded-full p-2\">\r\n                                <Check className=\"w-6 h-6 text-white\" />\r\n                              </div>\r\n                            </div>\r\n                          )}\r\n                          {!isOwned && isSoldOut && (\r\n                            <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center\">\r\n                              <Badge variant=\"destructive\">Распродано</Badge>\r\n                            </div>\r\n                          )}\r\n                          {acc.maxQuantity && !isSoldOut && (\r\n                            <Badge \r\n                              variant=\"secondary\" \r\n                              className=\"absolute top-2 right-2\"\r\n                            >\r\n                              {acc.maxQuantity - acc.soldCount} шт\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n\r\n                        <div>\r\n                          <h3 className=\"font-medium text-sm truncate\">{acc.nameRu}</h3>\r\n                          {acc.descriptionRu && (\r\n                            <p className=\"text-xs text-muted-foreground line-clamp-2\">{acc.descriptionRu}</p>\r\n                          )}\r\n                        </div>\r\n\r\n                        {isOwned ? (\r\n                          <Button \r\n                            variant=\"secondary\" \r\n                            size=\"sm\" \r\n                            className=\"w-full\" \r\n                            disabled\r\n                            data-testid={`button-owned-${acc.id}`}\r\n                          >\r\n                            <Check className=\"w-4 h-4 mr-1\" />\r\n                            Куплено\r\n                          </Button>\r\n                        ) : isSoldOut ? (\r\n                          <Button \r\n                            variant=\"secondary\" \r\n                            size=\"sm\" \r\n                            className=\"w-full\" \r\n                            disabled\r\n                            data-testid={`button-soldout-${acc.id}`}\r\n                          >\r\n                            <Lock className=\"w-4 h-4 mr-1\" />\r\n                            Распродано\r\n                          </Button>\r\n                        ) : (\r\n                          <Button\r\n                            size=\"sm\"\r\n                            className=\"w-full\"\r\n                            disabled={!canAfford || purchaseMutation.isPending}\r\n                            onClick={() => purchaseMutation.mutate(acc.id)}\r\n                            data-testid={`button-buy-${acc.id}`}\r\n                          >\r\n                            <Coins className=\"w-4 h-4 mr-1\" />\r\n                            {acc.price} Beads\r\n                          </Button>\r\n                        )}\r\n                      </CardContent>\r\n                    </Card>\r\n                  </motion.div>\r\n                );\r\n              })}\r\n            </AnimatePresence>\r\n          </div>\r\n        )}\r\n      </ScrollArea>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4500, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/CharacterCustomize.tsx"],"sourcesContent":["import { useState } from 'react';\r\nimport { useQuery, useMutation } from '@tanstack/react-query';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { ArrowLeft, Shirt, Check, X, Sparkles, Palette } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\nimport { apiRequest, queryClient } from '@/lib/queryClient';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { CharacterAvatar } from '@/components/CharacterAvatar';\r\nimport type { Accessory, AccessoryCategory, UserAccessory, CharacterWithAccessories } from '@shared/schema';\r\n\r\ninterface CharacterCustomizeProps {\r\n  onBack: () => void;\r\n}\r\n\r\nexport function CharacterCustomize({ onBack }: CharacterCustomizeProps) {\r\n  const { toast } = useToast();\r\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\r\n\r\n  const { data: characterData, isLoading: characterLoading } = useQuery<CharacterWithAccessories>({\r\n    queryKey: ['/api/character'],\r\n  });\r\n\r\n  const { data: categories = [], isLoading: categoriesLoading } = useQuery<AccessoryCategory[]>({\r\n    queryKey: ['/api/accessories/categories'],\r\n  });\r\n\r\n  const { data: ownedAccessories = [], isLoading: ownedLoading } = useQuery<UserAccessory[]>({\r\n    queryKey: ['/api/user/accessories'],\r\n  });\r\n\r\n  const { data: allAccessories = [] } = useQuery<Accessory[]>({\r\n    queryKey: ['/api/accessories'],\r\n  });\r\n\r\n  const equipMutation = useMutation({\r\n    mutationFn: async (accessoryId: string) => {\r\n      const response = await apiRequest('POST', '/api/accessories/equip', { accessoryId });\r\n      return response.json();\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['/api/character'] });\r\n      queryClient.invalidateQueries({ queryKey: ['/api/user/accessories'] });\r\n      toast({\r\n        title: 'Аксессуар надет!',\r\n        description: 'Ваш персонаж обновлён',\r\n      });\r\n    },\r\n    onError: (error: any) => {\r\n      toast({\r\n        title: 'Ошибка',\r\n        description: error.message || 'Не удалось надеть аксессуар',\r\n        variant: 'destructive',\r\n      });\r\n    },\r\n  });\r\n\r\n  const unequipMutation = useMutation({\r\n    mutationFn: async (accessoryId: string) => {\r\n      const response = await apiRequest('POST', '/api/accessories/unequip', { accessoryId });\r\n      return response.json();\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['/api/character'] });\r\n      queryClient.invalidateQueries({ queryKey: ['/api/user/accessories'] });\r\n      toast({\r\n        title: 'Аксессуар снят!',\r\n        description: 'Ваш персонаж обновлён',\r\n      });\r\n    },\r\n    onError: (error: any) => {\r\n      toast({\r\n        title: 'Ошибка',\r\n        description: error.message || 'Не удалось снять аксессуар',\r\n        variant: 'destructive',\r\n      });\r\n    },\r\n  });\r\n\r\n  const equippedIds = new Set(\r\n    characterData?.equippedAccessories?.map(ua => ua.accessoryId) || []\r\n  );\r\n\r\n  const accessoryMap = new Map<string, Accessory>();\r\n  allAccessories.forEach(acc => accessoryMap.set(acc.id, acc));\r\n\r\n  const ownedWithDetails = ownedAccessories.map(ua => ({\r\n    ...ua,\r\n    accessory: accessoryMap.get(ua.accessoryId),\r\n  })).filter(ua => ua.accessory);\r\n\r\n  const filteredOwned = ownedWithDetails.filter(ua => {\r\n    if (!selectedCategory) return true;\r\n    return ua.accessory?.categoryId === selectedCategory;\r\n  });\r\n\r\n  const sortedCategories = [...categories].sort((a, b) => a.sortOrder - b.sortOrder);\r\n\r\n  const isLoading = characterLoading || categoriesLoading || ownedLoading;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-b from-background to-muted flex flex-col\">\r\n      <header className=\"p-4 flex items-center justify-between border-b bg-background/80 backdrop-blur-sm sticky top-0 z-10\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <Button variant=\"ghost\" size=\"icon\" onClick={onBack} data-testid=\"button-back\">\r\n            <ArrowLeft className=\"w-5 h-5\" />\r\n          </Button>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Palette className=\"w-5 h-5 text-primary\" />\r\n            <h1 className=\"text-lg font-bold\">Кастомизация</h1>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      <div className=\"p-4 flex justify-center\">\r\n        <motion.div \r\n          initial={{ scale: 0.9, opacity: 0 }}\r\n          animate={{ scale: 1, opacity: 1 }}\r\n          className=\"relative\"\r\n        >\r\n          <div className=\"rounded-full bg-gradient-to-br from-primary/20 to-primary/5 p-2\">\r\n            <CharacterAvatar \r\n              characterData={characterData || null} \r\n              size={160}\r\n              className=\"rounded-full\"\r\n            />\r\n          </div>\r\n          {characterData?.character && (\r\n            <div className=\"text-center mt-2\">\r\n              <p className=\"font-medium\" data-testid=\"text-character-name\">\r\n                {characterData.character.name}\r\n              </p>\r\n            </div>\r\n          )}\r\n        </motion.div>\r\n      </div>\r\n\r\n      <div className=\"p-4 overflow-x-auto\">\r\n        <div className=\"flex gap-2 pb-2\">\r\n          <Button\r\n            variant={selectedCategory === null ? 'default' : 'outline'}\r\n            size=\"sm\"\r\n            onClick={() => setSelectedCategory(null)}\r\n            data-testid=\"button-category-all\"\r\n          >\r\n            Все\r\n          </Button>\r\n          {sortedCategories.map((cat) => (\r\n            <Button\r\n              key={cat.id}\r\n              variant={selectedCategory === cat.id ? 'default' : 'outline'}\r\n              size=\"sm\"\r\n              onClick={() => setSelectedCategory(cat.id)}\r\n              className=\"flex-shrink-0\"\r\n              data-testid={`button-category-${cat.id}`}\r\n            >\r\n              {cat.nameRu}\r\n            </Button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      <ScrollArea className=\"flex-1 px-4 pb-4\">\r\n        {isLoading ? (\r\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n            {[...Array(4)].map((_, i) => (\r\n              <Skeleton key={i} className=\"h-40 rounded-lg\" />\r\n            ))}\r\n          </div>\r\n        ) : filteredOwned.length === 0 ? (\r\n          <div className=\"flex flex-col items-center justify-center py-12 text-center\">\r\n            <Shirt className=\"w-16 h-16 text-muted-foreground/50 mb-4\" />\r\n            <p className=\"text-muted-foreground\">\r\n              {selectedCategory ? 'Нет аксессуаров в этой категории' : 'У вас ещё нет аксессуаров'}\r\n            </p>\r\n            <p className=\"text-sm text-muted-foreground/70 mt-1\">\r\n              Купите аксессуары в магазине\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <motion.div \r\n            className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\"\r\n            initial=\"hidden\"\r\n            animate=\"show\"\r\n            variants={{\r\n              hidden: { opacity: 0 },\r\n              show: {\r\n                opacity: 1,\r\n                transition: { staggerChildren: 0.05 },\r\n              },\r\n            }}\r\n          >\r\n            <AnimatePresence>\r\n              {filteredOwned.map((ua) => {\r\n                const accessory = ua.accessory!;\r\n                const isEquipped = equippedIds.has(accessory.id);\r\n                const isPending = equipMutation.isPending || unequipMutation.isPending;\r\n                \r\n                return (\r\n                  <motion.div\r\n                    key={ua.id}\r\n                    variants={{\r\n                      hidden: { opacity: 0, y: 20 },\r\n                      show: { opacity: 1, y: 0 },\r\n                    }}\r\n                  >\r\n                    <Card \r\n                      className={`overflow-hidden transition-all ${\r\n                        isEquipped ? 'ring-2 ring-primary' : ''\r\n                      }`}\r\n                      data-testid={`card-accessory-${accessory.id}`}\r\n                    >\r\n                      <CardContent className=\"p-3\">\r\n                        <div className=\"relative aspect-square mb-2 bg-muted/50 rounded-lg overflow-hidden\">\r\n                          <img\r\n                            src={accessory.imageUrl}\r\n                            alt={accessory.nameRu}\r\n                            className=\"w-full h-full object-contain p-2\"\r\n                            data-testid={`img-accessory-${accessory.id}`}\r\n                          />\r\n                          {isEquipped && (\r\n                            <div className=\"absolute top-1 right-1\">\r\n                              <Badge className=\"bg-primary text-primary-foreground text-xs px-1.5\">\r\n                                <Check className=\"w-3 h-3\" />\r\n                              </Badge>\r\n                            </div>\r\n                          )}\r\n                          {accessory.maxQuantity !== null && accessory.maxQuantity > 0 && (\r\n                            <div className=\"absolute top-1 left-1\">\r\n                              <Badge variant=\"secondary\" className=\"text-xs px-1.5 bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-400\">\r\n                                <Sparkles className=\"w-3 h-3\" />\r\n                              </Badge>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        \r\n                        <p className=\"font-medium text-sm truncate mb-2\" data-testid={`text-accessory-name-${accessory.id}`}>\r\n                          {accessory.nameRu}\r\n                        </p>\r\n                        \r\n                        <Button\r\n                          variant={isEquipped ? 'destructive' : 'default'}\r\n                          size=\"sm\"\r\n                          className=\"w-full\"\r\n                          disabled={isPending}\r\n                          onClick={() => {\r\n                            if (isEquipped) {\r\n                              unequipMutation.mutate(accessory.id);\r\n                            } else {\r\n                              equipMutation.mutate(accessory.id);\r\n                            }\r\n                          }}\r\n                          data-testid={`button-${isEquipped ? 'unequip' : 'equip'}-${accessory.id}`}\r\n                        >\r\n                          {isPending ? (\r\n                            <span className=\"animate-pulse\">...</span>\r\n                          ) : isEquipped ? (\r\n                            <>\r\n                              <X className=\"w-4 h-4 mr-1\" />\r\n                              Снять\r\n                            </>\r\n                          ) : (\r\n                            <>\r\n                              <Check className=\"w-4 h-4 mr-1\" />\r\n                              Надеть\r\n                            </>\r\n                          )}\r\n                        </Button>\r\n                      </CardContent>\r\n                    </Card>\r\n                  </motion.div>\r\n                );\r\n              })}\r\n            </AnimatePresence>\r\n          </motion.div>\r\n        )}\r\n      </ScrollArea>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5070, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/CommunityInviteDialog.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Users, MessageCircle, ExternalLink, Check, Loader2 } from 'lucide-react';\r\nimport { SiTelegram } from 'react-icons/si';\r\n\r\ninterface MembershipStatus {\r\n  inChannel: boolean;\r\n  inChat: boolean;\r\n  channelLink: string;\r\n  chatLink: string;\r\n}\r\n\r\ninterface CommunityInviteDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nexport function CommunityInviteDialog({ open, onOpenChange }: CommunityInviteDialogProps) {\r\n  const [hasOpenedLinks, setHasOpenedLinks] = useState({ channel: false, chat: false });\r\n  \r\n  const { data: membership, isLoading, refetch } = useQuery<MembershipStatus>({\r\n    queryKey: ['/api/telegram/check-membership'],\r\n    enabled: open,\r\n    refetchInterval: open ? 3000 : false,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (membership?.inChannel && membership?.inChat) {\r\n      setTimeout(() => onOpenChange(false), 1500);\r\n    }\r\n  }, [membership, onOpenChange]);\r\n\r\n  const handleOpenChannel = () => {\r\n    if (membership?.channelLink) {\r\n      window.open(membership.channelLink, '_blank');\r\n      setHasOpenedLinks(prev => ({ ...prev, channel: true }));\r\n    }\r\n  };\r\n\r\n  const handleOpenChat = () => {\r\n    if (membership?.chatLink) {\r\n      window.open(membership.chatLink, '_blank');\r\n      setHasOpenedLinks(prev => ({ ...prev, chat: true }));\r\n    }\r\n  };\r\n\r\n  const handleRefresh = () => {\r\n    refetch();\r\n  };\r\n\r\n  const allJoined = membership?.inChannel && membership?.inChat;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-sm\" data-testid=\"dialog-community-invite\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <SiTelegram className=\"w-6 h-6 text-[#0088cc]\" />\r\n            Присоединяйтесь к сообществу!\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            Подпишитесь на наш канал и чат, чтобы быть в курсе новостей, получать бонусы и общаться с другими игроками.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-3 py-4\">\r\n          <div className=\"flex items-center justify-between p-3 rounded-lg bg-muted/50\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <Users className=\"w-5 h-5 text-primary\" />\r\n              <div>\r\n                <div className=\"font-medium\">Канал Beads Lines</div>\r\n                <div className=\"text-xs text-muted-foreground\">Новости и обновления</div>\r\n              </div>\r\n            </div>\r\n            {isLoading ? (\r\n              <Loader2 className=\"w-5 h-5 animate-spin text-muted-foreground\" />\r\n            ) : membership?.inChannel ? (\r\n              <Check className=\"w-5 h-5 text-green-500\" />\r\n            ) : (\r\n              <Button size=\"sm\" variant=\"outline\" onClick={handleOpenChannel} data-testid=\"button-join-channel\">\r\n                <ExternalLink className=\"w-4 h-4 mr-1\" />\r\n                Открыть\r\n              </Button>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between p-3 rounded-lg bg-muted/50\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <MessageCircle className=\"w-5 h-5 text-primary\" />\r\n              <div>\r\n                <div className=\"font-medium\">Чат игроков</div>\r\n                <div className=\"text-xs text-muted-foreground\">Общение и помощь</div>\r\n              </div>\r\n            </div>\r\n            {isLoading ? (\r\n              <Loader2 className=\"w-5 h-5 animate-spin text-muted-foreground\" />\r\n            ) : membership?.inChat ? (\r\n              <Check className=\"w-5 h-5 text-green-500\" />\r\n            ) : (\r\n              <Button size=\"sm\" variant=\"outline\" onClick={handleOpenChat} data-testid=\"button-join-chat\">\r\n                <ExternalLink className=\"w-4 h-4 mr-1\" />\r\n                Открыть\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <DialogFooter className=\"flex-col gap-2 sm:flex-col\">\r\n          {allJoined ? (\r\n            <div className=\"flex items-center justify-center gap-2 text-green-600\">\r\n              <Check className=\"w-5 h-5\" />\r\n              <span className=\"font-medium\">Вы в сообществе!</span>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              {(hasOpenedLinks.channel || hasOpenedLinks.chat) && (\r\n                <Button variant=\"outline\" onClick={handleRefresh} className=\"w-full\" data-testid=\"button-refresh-membership\">\r\n                  <Loader2 className={`w-4 h-4 mr-2 ${isLoading ? 'animate-spin' : ''}`} />\r\n                  Проверить подписку\r\n                </Button>\r\n              )}\r\n              <Button variant=\"ghost\" onClick={() => onOpenChange(false)} className=\"w-full\" data-testid=\"button-skip-community\">\r\n                Позже\r\n              </Button>\r\n            </>\r\n          )}\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;AAcO,SAAS,sBAAsB,EAAE,IAAI,EAAE,YAAY,EAA8B;;IACtF,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,sIAAQ,EAAC;QAAE,SAAS;QAAO,MAAM;IAAM;IAEnF,MAAM,EAAE,MAAM,UAAU,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,IAAA,mLAAQ,EAAmB;QAC1E,UAAU;YAAC;SAAiC;QAC5C,SAAS;QACT,iBAAiB,OAAO,OAAO;IACjC;IAEA,IAAA,uIAAS;2CAAC;YACR,IAAI,YAAY,aAAa,YAAY,QAAQ;gBAC/C;uDAAW,IAAM,aAAa;sDAAQ;YACxC;QACF;0CAAG;QAAC;QAAY;KAAa;IAE7B,MAAM,oBAAoB;QACxB,IAAI,YAAY,aAAa;YAC3B,OAAO,IAAI,CAAC,WAAW,WAAW,EAAE;YACpC,kBAAkB,CAAA,OAAQ,CAAC;oBAAE,GAAG,IAAI;oBAAE,SAAS;gBAAK,CAAC;QACvD;IACF;IAEA,MAAM,iBAAiB;QACrB,IAAI,YAAY,UAAU;YACxB,OAAO,IAAI,CAAC,WAAW,QAAQ,EAAE;YACjC,kBAAkB,CAAA,OAAQ,CAAC;oBAAE,GAAG,IAAI;oBAAE,MAAM;gBAAK,CAAC;QACpD;IACF;IAEA,MAAM,gBAAgB;QACpB;IACF;IAEA,MAAM,YAAY,YAAY,aAAa,YAAY;IAEvD,qBACE,0JAAC,iIAAM;QAAC,MAAM;QAAM,cAAc;kBAChC,cAAA,0JAAC,wIAAa;YAAC,WAAU;YAAW,eAAY;;8BAC9C,0JAAC,uIAAY;;sCACX,0JAAC,sIAAW;4BAAC,WAAU;;8CACrB,0JAAC,wJAAU;oCAAC,WAAU;;;;;;gCAA2B;;;;;;;sCAGnD,0JAAC,4IAAiB;sCAAC;;;;;;;;;;;;8BAKrB,0JAAC;oBAAI,WAAU;;sCACb,0JAAC;4BAAI,WAAU;;8CACb,0JAAC;oCAAI,WAAU;;sDACb,0JAAC,yMAAK;4CAAC,WAAU;;;;;;sDACjB,0JAAC;;8DACC,0JAAC;oDAAI,WAAU;8DAAc;;;;;;8DAC7B,0JAAC;oDAAI,WAAU;8DAAgC;;;;;;;;;;;;;;;;;;gCAGlD,0BACC,0JAAC,wNAAO;oCAAC,WAAU;;;;;2CACjB,YAAY,0BACd,0JAAC,yMAAK;oCAAC,WAAU;;;;;yDAEjB,0JAAC,iIAAM;oCAAC,MAAK;oCAAK,SAAQ;oCAAU,SAAS;oCAAmB,eAAY;;sDAC1E,0JAAC,kOAAY;4CAAC,WAAU;;;;;;wCAAiB;;;;;;;;;;;;;sCAM/C,0JAAC;4BAAI,WAAU;;8CACb,0JAAC;oCAAI,WAAU;;sDACb,0JAAC,qOAAa;4CAAC,WAAU;;;;;;sDACzB,0JAAC;;8DACC,0JAAC;oDAAI,WAAU;8DAAc;;;;;;8DAC7B,0JAAC;oDAAI,WAAU;8DAAgC;;;;;;;;;;;;;;;;;;gCAGlD,0BACC,0JAAC,wNAAO;oCAAC,WAAU;;;;;2CACjB,YAAY,uBACd,0JAAC,yMAAK;oCAAC,WAAU;;;;;yDAEjB,0JAAC,iIAAM;oCAAC,MAAK;oCAAK,SAAQ;oCAAU,SAAS;oCAAgB,eAAY;;sDACvE,0JAAC,kOAAY;4CAAC,WAAU;;;;;;wCAAiB;;;;;;;;;;;;;;;;;;;8BAOjD,0JAAC,uIAAY;oBAAC,WAAU;8BACrB,0BACC,0JAAC;wBAAI,WAAU;;0CACb,0JAAC,yMAAK;gCAAC,WAAU;;;;;;0CACjB,0JAAC;gCAAK,WAAU;0CAAc;;;;;;;;;;;6CAGhC;;4BACG,CAAC,eAAe,OAAO,IAAI,eAAe,IAAI,mBAC7C,0JAAC,iIAAM;gCAAC,SAAQ;gCAAU,SAAS;gCAAe,WAAU;gCAAS,eAAY;;kDAC/E,0JAAC,wNAAO;wCAAC,WAAW,CAAC,aAAa,EAAE,YAAY,iBAAiB,IAAI;;;;;;oCAAI;;;;;;;0CAI7E,0JAAC,iIAAM;gCAAC,SAAQ;gCAAQ,SAAS,IAAM,aAAa;gCAAQ,WAAU;gCAAS,eAAY;0CAAwB;;;;;;;;;;;;;;;;;;;;;;;;AASjI;GAjHgB;;QAGmC,mLAAQ;;;KAH3C"}},
    {"offset": {"line": 5442, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/BeadsBox.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Gift, Coins, Zap, Heart, Ticket, X, Sparkles, Lock, Star } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Dialog, DialogContent, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { apiRequest } from \"@/lib/queryClient\";\r\nimport { playWinSound } from \"@/lib/sounds\";\r\nimport { useUser } from \"@/contexts/UserContext\";\r\n\r\ninterface BeadsBoxProps {\r\n  onClose: () => void;\r\n}\r\n\r\ninterface BeadsBoxReward {\r\n  type: 'beads' | 'boost' | 'lives' | 'crypto_ticket';\r\n  amount: number;\r\n  boostType?: string;\r\n  boostId?: string;\r\n  value?: number;\r\n}\r\n\r\ninterface BoxSessionResponse {\r\n  enabled: boolean;\r\n  message?: string;\r\n  session?: {\r\n    id: string;\r\n    boxes: Array<{ hidden?: boolean } | BeadsBoxReward>;\r\n    selectedBoxIndex: number | null;\r\n    rewardClaimed: boolean;\r\n    claimedReward: BeadsBoxReward | null;\r\n  };\r\n  cryptoTickets: number;\r\n  canGetCryptoTicket: boolean;\r\n}\r\n\r\ninterface ChooseBoxResponse {\r\n  success: boolean;\r\n  selectedIndex: number;\r\n  reward: BeadsBoxReward;\r\n  allBoxes: BeadsBoxReward[];\r\n}\r\n\r\nconst boxColors = [\r\n  \"from-yellow-500 to-amber-600\",\r\n  \"from-purple-500 to-indigo-600\",\r\n  \"from-emerald-500 to-teal-600\",\r\n  \"from-rose-500 to-pink-600\",\r\n  \"from-blue-500 to-cyan-600\",\r\n  \"from-orange-500 to-red-600\",\r\n];\r\n\r\nconst rewardIcons: Record<string, JSX.Element> = {\r\n  beads: <Coins className=\"w-12 h-12 text-yellow-400\" />,\r\n  boost: <Zap className=\"w-12 h-12 text-purple-400\" />,\r\n  lives: <Heart className=\"w-12 h-12 text-red-400\" />,\r\n  crypto_ticket: <Ticket className=\"w-12 h-12 text-green-400\" />,\r\n};\r\n\r\nconst smallRewardIcons: Record<string, JSX.Element> = {\r\n  beads: <Coins className=\"w-6 h-6 text-yellow-400\" />,\r\n  boost: <Zap className=\"w-6 h-6 text-purple-400\" />,\r\n  lives: <Heart className=\"w-6 h-6 text-red-400\" />,\r\n  crypto_ticket: <Ticket className=\"w-6 h-6 text-green-400\" />,\r\n};\r\n\r\nconst rewardNames: Record<string, string> = {\r\n  beads: \"Beads\",\r\n  boost: \"Буст\",\r\n  lives: \"Жизней\",\r\n  crypto_ticket: \"Крипто-билет\",\r\n};\r\n\r\nconst boostNames: Record<string, string> = {\r\n  double_points: \"2x Очки\",\r\n  slow_time: \"Замедление\",\r\n  extra_life: \"Жизнь\",\r\n  magnet: \"Магнит\",\r\n};\r\n\r\nfunction Confetti() {\r\n  const confettiColors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];\r\n  \r\n  return (\r\n    <div className=\"fixed inset-0 pointer-events-none overflow-hidden z-[60]\">\r\n      {[...Array(50)].map((_, i) => (\r\n        <motion.div\r\n          key={i}\r\n          initial={{\r\n            x: Math.random() * window.innerWidth,\r\n            y: -20,\r\n            rotate: 0,\r\n            scale: Math.random() * 0.5 + 0.5,\r\n          }}\r\n          animate={{\r\n            y: window.innerHeight + 20,\r\n            rotate: Math.random() * 720 - 360,\r\n            x: Math.random() * window.innerWidth,\r\n          }}\r\n          transition={{\r\n            duration: Math.random() * 2 + 2,\r\n            delay: Math.random() * 0.5,\r\n            ease: \"linear\",\r\n          }}\r\n          className=\"absolute w-3 h-3 rounded-sm\"\r\n          style={{\r\n            backgroundColor: confettiColors[i % confettiColors.length],\r\n          }}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction StarBurst() {\r\n  return (\r\n    <div className=\"absolute inset-0 pointer-events-none\">\r\n      {[...Array(12)].map((_, i) => (\r\n        <motion.div\r\n          key={i}\r\n          initial={{ scale: 0, opacity: 1 }}\r\n          animate={{ \r\n            scale: [0, 1.5, 0],\r\n            opacity: [1, 0.8, 0],\r\n          }}\r\n          transition={{\r\n            duration: 1,\r\n            delay: i * 0.05,\r\n            ease: \"easeOut\",\r\n          }}\r\n          className=\"absolute left-1/2 top-1/2\"\r\n          style={{\r\n            transform: `rotate(${i * 30}deg) translateY(-60px)`,\r\n          }}\r\n        >\r\n          <Star className=\"w-4 h-4 text-yellow-400 fill-yellow-400\" />\r\n        </motion.div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function BeadsBox({ onClose }: BeadsBoxProps) {\r\n  const queryClient = useQueryClient();\r\n  const { refreshUser } = useUser();\r\n  const [selectedBox, setSelectedBox] = useState<number | null>(null);\r\n  const [revealedReward, setRevealedReward] = useState<BeadsBoxReward | null>(null);\r\n  const [allRevealedBoxes, setAllRevealedBoxes] = useState<BeadsBoxReward[] | null>(null);\r\n  const [isRevealing, setIsRevealing] = useState(false);\r\n  const [showCelebration, setShowCelebration] = useState(false);\r\n  const [hasShownAlreadyClaimedReward, setHasShownAlreadyClaimedReward] = useState(false);\r\n  const [isNewlyClaimed, setIsNewlyClaimed] = useState(false);\r\n\r\n  const { data: boxData, isLoading, error } = useQuery<BoxSessionResponse>({\r\n    queryKey: [\"/api/beads-box/daily\"],\r\n  });\r\n\r\n  // Show celebration only for newly claimed rewards (not for already-claimed on page load)\r\n  useEffect(() => {\r\n    if (revealedReward && isNewlyClaimed) {\r\n      setShowCelebration(true);\r\n      const timer = setTimeout(() => {\r\n        setShowCelebration(false);\r\n        // Reset the flag so celebration doesn't replay on query refresh\r\n        setIsNewlyClaimed(false);\r\n      }, 3000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [revealedReward, isNewlyClaimed]);\r\n\r\n  // Show already claimed reward on first load (no celebration)\r\n  useEffect(() => {\r\n    // Only run once when component mounts and data is loaded\r\n    if (boxData?.session?.claimedReward && !hasShownAlreadyClaimedReward) {\r\n      setHasShownAlreadyClaimedReward(true);\r\n      // Set reward without celebration flag\r\n      setRevealedReward(boxData.session.claimedReward);\r\n      \r\n      // Also set revealed boxes if available\r\n      const boxes = boxData.session.boxes;\r\n      if (boxes && boxes.length > 0 && !('hidden' in boxes[0])) {\r\n        setAllRevealedBoxes(boxes as BeadsBoxReward[]);\r\n      }\r\n    }\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [boxData?.session?.claimedReward]);\r\n\r\n  const chooseMutation = useMutation({\r\n    mutationFn: async ({ sessionId, boxIndex }: { sessionId: string; boxIndex: number }) => {\r\n      const response = await apiRequest(\"POST\", \"/api/beads-box/choose\", { sessionId, boxIndex });\r\n      return response.json() as Promise<ChooseBoxResponse>;\r\n    },\r\n    onSuccess: (data) => {\r\n      setIsNewlyClaimed(true);\r\n      setRevealedReward(data.reward);\r\n      setAllRevealedBoxes(data.allBoxes);\r\n      setIsRevealing(false);\r\n      // Play fanfare sound on reward\r\n      playWinSound();\r\n      queryClient.invalidateQueries({ queryKey: [\"/api/beads-box/daily\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"/api/user/boosts\"] });\r\n      // Refresh user to update bonusLives and beads balance in UI\r\n      refreshUser();\r\n    },\r\n    onError: (err) => {\r\n      console.error(\"Choose box error:\", err);\r\n      setIsRevealing(false);\r\n      setSelectedBox(null);\r\n    },\r\n  });\r\n\r\n  const handleBoxClick = (index: number) => {\r\n    console.log('BeadsBox handleBoxClick:', { index, session: boxData?.session, selectedBoxIndex: boxData?.session?.selectedBoxIndex, isRevealing });\r\n    if (!boxData?.session || boxData.session.selectedBoxIndex !== null || isRevealing) {\r\n      console.log('BeadsBox click ignored:', { hasSession: !!boxData?.session, selectedBoxIndex: boxData?.session?.selectedBoxIndex, isRevealing });\r\n      return;\r\n    }\r\n    \r\n    setSelectedBox(index);\r\n    setIsRevealing(true);\r\n    \r\n    console.log('BeadsBox choosing box:', { sessionId: boxData.session.id, boxIndex: index });\r\n    // Call mutation immediately - no delay for better mobile responsiveness\r\n    chooseMutation.mutate({ sessionId: boxData.session.id, boxIndex: index });\r\n  };\r\n\r\n  const getRewardDisplay = (reward: BeadsBoxReward) => {\r\n    switch (reward.type) {\r\n      case 'beads':\r\n        return `+${reward.amount} ${rewardNames.beads}`;\r\n      case 'boost':\r\n        return `${boostNames[reward.boostType || ''] || reward.boostType} x1`;\r\n      case 'lives':\r\n        return `+${reward.amount} ${rewardNames.lives}`;\r\n      case 'crypto_ticket':\r\n        return rewardNames.crypto_ticket;\r\n      default:\r\n        return 'Награда';\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <Dialog open onOpenChange={() => onClose()}>\r\n        <DialogContent className=\"bg-gradient-to-b from-slate-900 to-slate-950 border-slate-700 max-w-md\">\r\n          <DialogTitle className=\"sr-only\">BEADS BOX</DialogTitle>\r\n          <div className=\"text-center py-12\">\r\n            <motion.div\r\n              animate={{ rotate: 360 }}\r\n              transition={{ duration: 2, repeat: Infinity, ease: \"linear\" }}\r\n              className=\"inline-block\"\r\n            >\r\n              <Gift className=\"w-16 h-16 text-yellow-400\" />\r\n            </motion.div>\r\n            <p className=\"mt-4 text-white font-semibold\">Загрузка...</p>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    );\r\n  }\r\n\r\n  if (error || !boxData?.enabled) {\r\n    return (\r\n      <Dialog open onOpenChange={() => onClose()}>\r\n        <DialogContent className=\"bg-gradient-to-b from-slate-900 to-slate-950 border-slate-700 max-w-sm\">\r\n          <DialogTitle className=\"sr-only\">BEADS BOX</DialogTitle>\r\n          <div className=\"text-center py-8\">\r\n            <Lock className=\"w-12 h-12 text-slate-400 mx-auto mb-4\" />\r\n            <p className=\"text-white font-semibold mb-2\">BEADS BOX недоступен</p>\r\n            <p className=\"text-slate-400 text-sm mb-4\">{boxData?.message || \"Функция временно отключена\"}</p>\r\n            <Button onClick={onClose} variant=\"outline\">\r\n              Закрыть\r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    );\r\n  }\r\n\r\n  const session = boxData.session;\r\n  const alreadyClaimed = session?.selectedBoxIndex !== null;\r\n  const showingReward = !!revealedReward;\r\n\r\n  return (\r\n    <>\r\n      {showCelebration && <Confetti />}\r\n      \r\n      <Dialog open onOpenChange={() => onClose()}>\r\n        <DialogContent className=\"bg-gradient-to-b from-slate-900 via-slate-900 to-slate-950 border-slate-700 max-w-sm max-h-[85vh] p-0 overflow-y-auto\">\r\n          <DialogTitle className=\"sr-only\">BEADS BOX - Ежедневная награда</DialogTitle>\r\n          \r\n          <div className=\"relative\">\r\n            <div className=\"absolute inset-0 bg-gradient-to-b from-yellow-500/10 to-transparent pointer-events-none\" />\r\n            \r\n            <div className=\"p-6\">\r\n              <div className=\"flex items-center justify-between mb-6\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <motion.div \r\n                    animate={{ rotate: [0, -10, 10, -10, 0] }}\r\n                    transition={{ duration: 0.5, repeat: Infinity, repeatDelay: 3 }}\r\n                    className=\"p-3 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-2xl shadow-lg shadow-yellow-500/30\"\r\n                  >\r\n                    <Gift className=\"w-7 h-7 text-white\" />\r\n                  </motion.div>\r\n                  <div>\r\n                    <h2 className=\"text-2xl font-bold text-white\">BEADS BOX</h2>\r\n                    <p className=\"text-sm text-slate-400\">Ежедневная награда</p>\r\n                  </div>\r\n                </div>\r\n                <Button\r\n                  size=\"icon\"\r\n                  variant=\"ghost\"\r\n                  onClick={onClose}\r\n                  className=\"text-slate-400 hover:text-white\"\r\n                  data-testid=\"button-close-beadsbox\"\r\n                >\r\n                  <X className=\"w-5 h-5\" />\r\n                </Button>\r\n              </div>\r\n\r\n              {boxData.cryptoTickets > 0 && (\r\n                <motion.div \r\n                  initial={{ opacity: 0, y: -10 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  className=\"mb-4 p-3 bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-xl border border-green-500/30\"\r\n                >\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Ticket className=\"w-5 h-5 text-green-400\" />\r\n                    <span className=\"text-green-400 font-semibold\">\r\n                      Крипто-билетов: {boxData.cryptoTickets}\r\n                    </span>\r\n                  </div>\r\n                  <p className=\"text-xs text-green-300/70 mt-1\">\r\n                    Используй в меню выбора уровня для игры с криптошариками!\r\n                  </p>\r\n                </motion.div>\r\n              )}\r\n              \r\n              {/* Show hint about crypto ticket requirements */}\r\n              {!boxData.canGetCryptoTicket && boxData.cryptoTickets === 0 && (\r\n                <motion.div \r\n                  initial={{ opacity: 0, y: -10 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  className=\"mb-4 p-3 bg-gradient-to-r from-amber-500/10 to-orange-500/10 rounded-xl border border-amber-500/20\"\r\n                >\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Lock className=\"w-4 h-4 text-amber-400\" />\r\n                    <span className=\"text-amber-400 text-sm\">\r\n                      Крипто-билет доступен после 10 уровня\r\n                    </span>\r\n                  </div>\r\n                </motion.div>\r\n              )}\r\n\r\n              <AnimatePresence mode=\"wait\">\r\n                {showingReward && revealedReward ? (\r\n                  <motion.div\r\n                    key=\"reward\"\r\n                    initial={{ scale: 0.5, opacity: 0 }}\r\n                    animate={{ scale: 1, opacity: 1 }}\r\n                    exit={{ scale: 0.5, opacity: 0 }}\r\n                    className=\"relative mb-6 p-8 bg-gradient-to-br from-yellow-500/30 via-amber-500/20 to-orange-500/30 rounded-3xl border-2 border-yellow-500/50 text-center overflow-hidden\"\r\n                  >\r\n                    <StarBurst />\r\n                    \r\n                    <motion.div\r\n                      initial={{ scale: 0 }}\r\n                      animate={{ scale: [0, 1.2, 1] }}\r\n                      transition={{ duration: 0.5, delay: 0.2 }}\r\n                    >\r\n                      <Sparkles className=\"w-10 h-10 text-yellow-400 mx-auto mb-3\" />\r\n                    </motion.div>\r\n                    \r\n                    <motion.p \r\n                      initial={{ opacity: 0, y: 10 }}\r\n                      animate={{ opacity: 1, y: 0 }}\r\n                      transition={{ delay: 0.3 }}\r\n                      className=\"text-yellow-400 font-bold text-xl mb-4\"\r\n                    >\r\n                      {alreadyClaimed && hasShownAlreadyClaimedReward ? \"Ваша награда сегодня\" : \"Поздравляем!\"}\r\n                    </motion.p>\r\n                    \r\n                    <motion.div\r\n                      initial={{ scale: 0 }}\r\n                      animate={{ scale: 1 }}\r\n                      transition={{ delay: 0.4, type: \"spring\", stiffness: 200 }}\r\n                      className=\"flex flex-col items-center gap-2\"\r\n                    >\r\n                      <div className=\"p-4 bg-white/10 rounded-2xl backdrop-blur-sm\">\r\n                        {rewardIcons[revealedReward.type]}\r\n                      </div>\r\n                      <p className=\"text-white font-bold text-2xl\">\r\n                        {getRewardDisplay(revealedReward)}\r\n                      </p>\r\n                      {revealedReward.type === \"crypto_ticket\" && (\r\n                        <p className=\"text-sm text-yellow-300/80\">\r\n                          Бесплатная игра с крипто-шариками!\r\n                        </p>\r\n                      )}\r\n                    </motion.div>\r\n                    \r\n                    {alreadyClaimed && hasShownAlreadyClaimedReward && (\r\n                      <motion.p\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        transition={{ delay: 0.6 }}\r\n                        className=\"text-sm text-slate-400 mt-4\"\r\n                      >\r\n                        Приходите завтра за новой наградой!\r\n                      </motion.p>\r\n                    )}\r\n                  </motion.div>\r\n                ) : !alreadyClaimed ? (\r\n                  <motion.p \r\n                    key=\"instruction\"\r\n                    initial={{ opacity: 0 }}\r\n                    animate={{ opacity: 1 }}\r\n                    className=\"text-center text-slate-300 mb-6\"\r\n                  >\r\n                    Выберите один из 6 боксов!\r\n                  </motion.p>\r\n                ) : null}\r\n              </AnimatePresence>\r\n\r\n              <div className=\"grid grid-cols-3 gap-3 mb-6\">\r\n                {(allRevealedBoxes || session?.boxes || []).map((box, index) => {\r\n                  const isSelected = selectedBox === index || session?.selectedBoxIndex === index;\r\n                  const boxAsAny = box as { hidden?: boolean };\r\n                  const isHidden = !allRevealedBoxes && (!('type' in box) || boxAsAny.hidden === true);\r\n                  const reward = !isHidden && 'type' in box ? box as BeadsBoxReward : null;\r\n                  const canInteract = !alreadyClaimed && !isRevealing && !showingReward;\r\n\r\n                  return (\r\n                    <motion.div\r\n                      key={index}\r\n                      onPointerDown={(e) => {\r\n                        e.stopPropagation();\r\n                        if (canInteract) {\r\n                          handleBoxClick(index);\r\n                        }\r\n                      }}\r\n                      role=\"button\"\r\n                      tabIndex={canInteract ? 0 : -1}\r\n                      whileHover={canInteract ? { scale: 1.08, y: -4 } : undefined}\r\n                      whileTap={canInteract ? { scale: 0.95 } : undefined}\r\n                      animate={isSelected && isRevealing ? { \r\n                        rotateY: [0, 360],\r\n                        scale: [1, 1.1, 1],\r\n                      } : undefined}\r\n                      transition={{ duration: 0.8 }}\r\n                      className={`\r\n                        relative aspect-square rounded-2xl p-2\r\n                        flex flex-col items-center justify-center\r\n                        transition-all duration-300 select-none\r\n                        ${isHidden \r\n                          ? `bg-gradient-to-br ${boxColors[index]} shadow-lg ${canInteract ? 'cursor-pointer active:scale-95' : 'cursor-default'}` \r\n                          : 'bg-slate-800/80 border border-slate-600'\r\n                        }\r\n                        ${isSelected && !isRevealing ? 'ring-4 ring-yellow-400 ring-offset-2 ring-offset-slate-900' : ''}\r\n                        ${showingReward && !isSelected ? 'opacity-40' : ''}\r\n                      `}\r\n                      data-testid={`button-box-${index}`}\r\n                    >\r\n                      {isHidden ? (\r\n                        <motion.div\r\n                          animate={canInteract ? { y: [0, -3, 0] } : undefined}\r\n                          transition={{ duration: 1.5, repeat: Infinity, delay: index * 0.1 }}\r\n                          className=\"flex flex-col items-center pointer-events-none\"\r\n                        >\r\n                          {isSelected && isRevealing ? (\r\n                            <motion.div\r\n                              animate={{ rotate: 360 }}\r\n                              transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\r\n                            >\r\n                              <Gift className=\"w-10 h-10 text-yellow-400 drop-shadow-lg\" />\r\n                            </motion.div>\r\n                          ) : (\r\n                            <Gift className=\"w-10 h-10 text-white/90 drop-shadow-lg\" />\r\n                          )}\r\n                          <span className=\"text-white/80 text-xs font-bold mt-1\">#{index + 1}</span>\r\n                        </motion.div>\r\n                      ) : reward && (\r\n                        <motion.div\r\n                          initial={{ scale: 0, rotate: -180 }}\r\n                          animate={{ scale: 1, rotate: 0 }}\r\n                          transition={{ type: \"spring\", stiffness: 200 }}\r\n                          className=\"flex flex-col items-center pointer-events-none\"\r\n                        >\r\n                          {smallRewardIcons[reward.type]}\r\n                          <span className=\"text-white text-[10px] font-semibold mt-1 text-center leading-tight\">\r\n                            {reward.type === \"boost\" \r\n                              ? boostNames[reward.boostType || ''] || reward.boostType\r\n                              : reward.type === 'crypto_ticket'\r\n                                ? 'Билет'\r\n                                : `+${reward.amount}`\r\n                            }\r\n                          </span>\r\n                        </motion.div>\r\n                      )}\r\n                    </motion.div>\r\n                  );\r\n                })}\r\n              </div>\r\n\r\n              {!boxData.canGetCryptoTicket && !showingReward && !alreadyClaimed && (\r\n                <div className=\"mb-4 p-3 bg-slate-800/50 rounded-xl border border-slate-700\">\r\n                  <div className=\"flex items-center gap-2 text-slate-400\">\r\n                    <Lock className=\"w-4 h-4 flex-shrink-0\" />\r\n                    <span className=\"text-xs\">\r\n                      Пройдите все 10 уровней для шанса получить крипто-билет\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              <Button\r\n                onClick={onClose}\r\n                className=\"w-full bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-600 hover:to-yellow-600 text-white font-bold py-6 text-lg\"\r\n                data-testid=\"button-continue-beadsbox\"\r\n              >\r\n                {showingReward ? (alreadyClaimed && hasShownAlreadyClaimedReward ? \"Закрыть\" : \"Забрать награду\") : \"Отмена\"}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6534, "column": 0}, "map": {"version":3,"sources":["file:///D:/BeadsLine/components/MaintenancePage.tsx"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Wrench, Clock, RefreshCw } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\ninterface MaintenanceConfig {\r\n  enabled: boolean;\r\n  endTime: string | null;\r\n  message: string | null;\r\n}\r\n\r\ninterface MaintenancePageProps {\r\n  endTime: string | null;\r\n  message: string | null;\r\n}\r\n\r\ninterface TimeLeft {\r\n  days: number;\r\n  hours: number;\r\n  minutes: number;\r\n  seconds: number;\r\n}\r\n\r\nfunction calculateTimeLeft(endTime: string | null): TimeLeft | null {\r\n  if (!endTime) return null;\r\n  \r\n  const end = new Date(endTime).getTime();\r\n  const now = new Date().getTime();\r\n  const difference = end - now;\r\n  \r\n  if (difference <= 0) return null;\r\n  \r\n  return {\r\n    days: Math.floor(difference / (1000 * 60 * 60 * 24)),\r\n    hours: Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),\r\n    minutes: Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60)),\r\n    seconds: Math.floor((difference % (1000 * 60)) / 1000)\r\n  };\r\n}\r\n\r\nexport default function MaintenancePage({ endTime: initialEndTime, message: initialMessage }: MaintenancePageProps) {\r\n  const { data: maintenance } = useQuery<MaintenanceConfig>({\r\n    queryKey: [\"/api/maintenance\"],\r\n    refetchInterval: 10000,\r\n  });\r\n\r\n  const endTime = maintenance?.endTime ?? initialEndTime;\r\n  const message = maintenance?.message ?? initialMessage;\r\n\r\n  const [timeLeft, setTimeLeft] = useState<TimeLeft | null>(calculateTimeLeft(endTime));\r\n  const [isExpired, setIsExpired] = useState(false);\r\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\r\n  const endTimeRef = useRef<string | null>(endTime);\r\n\r\n  useEffect(() => {\r\n    endTimeRef.current = endTime;\r\n  }, [endTime]);\r\n\r\n  useEffect(() => {\r\n    if (maintenance && !maintenance.enabled) {\r\n      window.location.reload();\r\n    }\r\n  }, [maintenance]);\r\n\r\n  useEffect(() => {\r\n    setTimeLeft(calculateTimeLeft(endTime));\r\n    setIsExpired(false);\r\n  }, [endTime]);\r\n\r\n  useEffect(() => {\r\n    if (timerRef.current) {\r\n      clearInterval(timerRef.current);\r\n    }\r\n\r\n    timerRef.current = setInterval(() => {\r\n      const currentEndTime = endTimeRef.current;\r\n      const newTimeLeft = calculateTimeLeft(currentEndTime);\r\n      \r\n      if (currentEndTime && !newTimeLeft) {\r\n        setIsExpired(true);\r\n        if (timerRef.current) {\r\n          clearInterval(timerRef.current);\r\n        }\r\n        setTimeout(() => {\r\n          window.location.reload();\r\n        }, 2000);\r\n      } else {\r\n        setTimeLeft(newTimeLeft);\r\n      }\r\n    }, 1000);\r\n\r\n    return () => {\r\n      if (timerRef.current) {\r\n        clearInterval(timerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const handleRefresh = () => {\r\n    window.location.reload();\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\r\n      <Card className=\"w-full max-w-md text-center\">\r\n        <CardHeader className=\"pb-2\">\r\n          <div className=\"flex justify-center mb-4\">\r\n            <div className=\"w-20 h-20 rounded-full bg-muted flex items-center justify-center\">\r\n              <Wrench className=\"w-10 h-10 text-muted-foreground\" />\r\n            </div>\r\n          </div>\r\n          <CardTitle className=\"text-xl\">Технические работы</CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-6\">\r\n          <p className=\"text-muted-foreground\">\r\n            {message || \"Мы обновляем приложение для улучшения вашего опыта. Пожалуйста, подождите.\"}\r\n          </p>\r\n\r\n          {isExpired ? (\r\n            <div className=\"space-y-4\">\r\n              <p className=\"text-primary font-medium\">Работы завершены!</p>\r\n              <p className=\"text-sm text-muted-foreground\">Страница обновится автоматически...</p>\r\n            </div>\r\n          ) : timeLeft ? (\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center justify-center gap-2 text-muted-foreground text-sm\">\r\n                <Clock className=\"w-4 h-4\" />\r\n                <span>Ожидаемое время запуска:</span>\r\n              </div>\r\n              \r\n              <div className=\"grid grid-cols-4 gap-2\" data-testid=\"countdown-timer\">\r\n                <div className=\"bg-muted rounded-lg p-3\">\r\n                  <div className=\"text-2xl font-bold text-foreground\" data-testid=\"countdown-days\">\r\n                    {timeLeft.days}\r\n                  </div>\r\n                  <div className=\"text-xs text-muted-foreground\">дней</div>\r\n                </div>\r\n                <div className=\"bg-muted rounded-lg p-3\">\r\n                  <div className=\"text-2xl font-bold text-foreground\" data-testid=\"countdown-hours\">\r\n                    {timeLeft.hours}\r\n                  </div>\r\n                  <div className=\"text-xs text-muted-foreground\">часов</div>\r\n                </div>\r\n                <div className=\"bg-muted rounded-lg p-3\">\r\n                  <div className=\"text-2xl font-bold text-foreground\" data-testid=\"countdown-minutes\">\r\n                    {timeLeft.minutes}\r\n                  </div>\r\n                  <div className=\"text-xs text-muted-foreground\">минут</div>\r\n                </div>\r\n                <div className=\"bg-muted rounded-lg p-3\">\r\n                  <div className=\"text-2xl font-bold text-foreground\" data-testid=\"countdown-seconds\">\r\n                    {timeLeft.seconds}\r\n                  </div>\r\n                  <div className=\"text-xs text-muted-foreground\">секунд</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Время окончания не указано\r\n            </p>\r\n          )}\r\n\r\n          <Button \r\n            variant=\"outline\" \r\n            onClick={handleRefresh}\r\n            className=\"w-full\"\r\n            data-testid=\"button-refresh\"\r\n          >\r\n            <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n            Обновить страницу\r\n          </Button>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}