Нужно добавить в игру BeadLine реферальную систему (2 уровня) через Telegram‑бота. Все бонусы — только в Beads, без прямых денежных наград.

Структура в БД
Для пользователя:
– referralCode — уникальный реферальный код.
– referredBy — userId пригласившего (или null).
– directReferralsCount — количество рефералов 1‑го уровня.

Отдельная таблица ReferralRewards:
– id, userId (кто получил бонус), refUserId (за чью игру), level (1 или 2), beadsAmount, createdAt.

Реферальная ссылка через Telegram
Реф‑ссылка должна иметь вид:
https://t.me/ИМЯ_МОЕГО_БОТА?start=REFERRAL_CODE

При первом запуске мини‑аппа в Telegram:
– считать start/start_param как referralCode;
– найти пользователя с таким referralCode;
– если нашёлся и это не сам пользователь, и у него directReferralsCount < maxDirectReferralsPerUser (см. ниже),

записать referredBy = inviterId,

увеличить directReferralsCount;
– если не нашёлся или лимит достигнут, зарегистрировать без пригласителя (referredBy = null).
– referredBy после установки не менять.

В коде не нужно жёстко зашивать домен web‑игры, только username бота и логику работы с параметром start.
Сделать API, возвращающий для авторизованного пользователя:
– его referralCode;
– готовую ссылку: https://t.me/ИМЯ_МОЕГО_БОТА?start=REFERRAL_CODE.

Начисление реферальных Beads
Модель 2 уровней:
– 1‑й уровень: пригласивший получает 10% от Beads, заработанных рефералом за сессию.
– 2‑й уровень: пригласивший второго уровня получает 3% от Beads, заработанных “рефералом реферала”.

При окончании игры:
– есть userId и scoreBeads (Beads за эту сессию).
– inviter1 = referredBy(user); inviter2 = referredBy(inviter1) (если есть).
– bonus1 = floor(scoreBeads × 0.10), bonus2 = floor(scoreBeads × 0.03).
– добавить bonus1 к Beads inviter1 и bonus2 к Beads inviter2;
– записать по строке в ReferralRewards для каждого бонуса.

Реф‑бонусы должны увеличивать только виртуальные Beads. Реальные USDT/BTC‑награды считаются отдельно и не зависят напрямую от реф‑бонусов.

Лимиты и регистрация без рефки
Параметры в настройках:
– maxDirectReferralsPerUser (по умолчанию 1000) — максимум рефералов 1‑го уровня у одного пользователя.
– maxReferralBeadsPerRefPerDay и maxReferralBeadsPerUserPerDay — мягкие лимиты, задать очень большими числами, но учесть в коде (на будущее).

Логика:
– если пользователь зашёл без параметра start или по невалидному коду, он регистрируется без referredBy;
– если при начислении реф‑бонусов превышается один из лимитов, “лишняя” часть бонуса не начисляется, но сейчас при больших значениях лимитов это почти не сработает.

Админка
В админ‑панели добавить раздел “Рефералы”:
– список пользователей: id, username, referralCode, referredBy, число рефералов 1‑го уровня и 2‑го уровня, totalReferralBeads;
– форму настройки: проценты бонусов 1‑го и 2‑го уровней, maxDirectReferralsPerUser, maxReferralBeadsPerRefPerDay, maxReferralBeadsPerUserPerDay.

Все вычисления реф‑бонусов выполняются только на сервере, клиент получает уже готовые значения.»]